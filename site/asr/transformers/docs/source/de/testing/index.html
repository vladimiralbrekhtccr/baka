
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../../../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Testing - Ohayou</title>
      
    
    
      <link rel="stylesheet" href="../../../../../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../../assets/extra.css">
    
    <script>__md_scope=new URL("../../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#testen" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../../.." title="Ohayou" class="md-header__button md-logo" aria-label="Ohayou" data-md-component="logo">
      
  <img src="../../../../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ohayou
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Testing
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../../ohayou/" class="md-tabs__link">
        
  
  
    
  
  Ohayou

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../../vllm/open_ai_vllm_example_a_v_t/" class="md-tabs__link">
          
  
  
    
  
  vLLM

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../../llm/speculative_decoding/" class="md-tabs__link">
          
  
  
    
  
  LLM

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../../vlm/qwen3_vl_4B_object_detection/" class="md-tabs__link">
          
  
  
    
  
  VLM

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../../md_format_helpers/" class="md-tabs__link">
        
  
  
    
  
  MD format helpers

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../../docker/" class="md-tabs__link">
        
  
  
    
  
  Docker

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../../linux/" class="md-tabs__link">
        
  
  
    
  
  Linux

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../../moe/" class="md-tabs__link">
        
  
  
    
  
  Mixture of Experts

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../../slurm/" class="md-tabs__link">
        
  
  
    
  
  Slurm

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../../japanese-phrases/" class="md-tabs__link">
          
  
  
    
  
  Japanese Phrases

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../../hackathon/index.md" class="md-tabs__link">
        
  
  
    
  
  Hack

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../../.." title="Ohayou" class="md-nav__button md-logo" aria-label="Ohayou" data-md-component="logo">
      
  <img src="../../../../../../assets/logo.png" alt="logo">

    </a>
    Ohayou
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../ohayou/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ohayou
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    vLLM
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            vLLM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../vllm/open_ai_vllm_example_a_v_t/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Single Request
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../vllm/bash_vllm_serve/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bash online serve
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../vllm/benchmarks/performance_eval/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Benchmarks
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    LLM
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            LLM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../llm/speculative_decoding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Speculative Decoding
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    VLM
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            VLM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../vlm/qwen3_vl_4B_object_detection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Qwen3VL_adema_grounding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../vlm/qwen3_vla_4B_audio_training_aspandiyar/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Qwen3VLA_aspandiyar_thinking
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../md_format_helpers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MD format helpers
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linux
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../moe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mixture of Experts
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../slurm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Slurm
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../../japanese-phrases/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Japanese Phrases
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_11" id="__nav_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Japanese Phrases
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../../japanese-phrases/daily-life/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Daily Life
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_11_2" id="__nav_11_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_2">
            <span class="md-nav__icon md-icon"></span>
            Daily Life
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../japanese-phrases/daily-life/shopping/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shopping
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../../japanese-phrases/greetings/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Greetings
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_11_3" id="__nav_11_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_3">
            <span class="md-nav__icon md-icon"></span>
            Greetings
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../japanese-phrases/greetings/casual/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Casual
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../japanese-phrases/emotions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Emotions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../japanese-phrases/anime-manga/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Anime/Manga
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../hackathon/index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hack
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#wie-transformatoren-getestet-werden" class="md-nav__link">
    <span class="md-ellipsis">
      Wie Transformatoren getestet werden
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tests-ausfuhren" class="md-nav__link">
    <span class="md-ellipsis">
      Tests ausf√ºhren
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tests ausf√ºhren">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#auswahl-der-auszufuhrenden-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Auswahl der auszuf√ºhrenden Tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#abrufen-der-liste-aller-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Abrufen der Liste aller Tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fuhren-sie-ein-bestimmtes-testmodul-aus" class="md-nav__link">
    <span class="md-ellipsis">
      F√ºhren Sie ein bestimmtes Testmodul aus
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spezifische-tests-ausfuhren" class="md-nav__link">
    <span class="md-ellipsis">
      Spezifische Tests ausf√ºhren
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fuhren-sie-accelerate-tests-durch" class="md-nav__link">
    <span class="md-ellipsis">
      F√ºhren Sie accelerate Tests durch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dokumentationstests-ausfuhren" class="md-nav__link">
    <span class="md-ellipsis">
      Dokumentationstests ausf√ºhren
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nur-geanderte-tests-ausfuhren" class="md-nav__link">
    <span class="md-ellipsis">
      Nur ge√§nderte Tests ausf√ºhren
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fehlgeschlagene-tests-bei-anderung-der-quelle-automatisch-wiederholen" class="md-nav__link">
    <span class="md-ellipsis">
      Fehlgeschlagene Tests bei √Ñnderung der Quelle automatisch wiederholen
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uberspringen-eines-testmoduls" class="md-nav__link">
    <span class="md-ellipsis">
      √úberspringen eines Testmoduls
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#status-leeren" class="md-nav__link">
    <span class="md-ellipsis">
      Status leeren
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tests-parallel-ausfuhren" class="md-nav__link">
    <span class="md-ellipsis">
      Tests parallel ausf√ºhren
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testreihenfolge-und-wiederholung" class="md-nav__link">
    <span class="md-ellipsis">
      Testreihenfolge und Wiederholung
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testreihenfolge und Wiederholung">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wiederholungstests" class="md-nav__link">
    <span class="md-ellipsis">
      Wiederholungstests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-tests-in-a-random-order" class="md-nav__link">
    <span class="md-ellipsis">
      Run tests in a random order
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variationen-von-aussehen-und-bedienung" class="md-nav__link">
    <span class="md-ellipsis">
      Variationen von Aussehen und Bedienung
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Variationen von Aussehen und Bedienung">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pytest-zucker" class="md-nav__link">
    <span class="md-ellipsis">
      pytest-zucker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#melden-sie-den-namen-jedes-subtests-und-seinen-fortschritt" class="md-nav__link">
    <span class="md-ellipsis">
      Melden Sie den Namen jedes Subtests und seinen Fortschritt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeigt-fehlgeschlagene-tests-sofort-an" class="md-nav__link">
    <span class="md-ellipsis">
      Zeigt fehlgeschlagene Tests sofort an
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zu-gpu-oder-nicht-zu-gpu" class="md-nav__link">
    <span class="md-ellipsis">
      Zu GPU oder nicht zu GPU
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testen-mit-einem-bestimmten-pytorch-backend-oder-gerat" class="md-nav__link">
    <span class="md-ellipsis">
      Testen mit einem bestimmten PyTorch-Backend oder Ger√§t
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verteiltes-training" class="md-nav__link">
    <span class="md-ellipsis">
      Verteiltes Training
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#erfassung-von-ausgaben" class="md-nav__link">
    <span class="md-ellipsis">
      Erfassung von Ausgaben
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#farbsteuerung" class="md-nav__link">
    <span class="md-ellipsis">
      Farbsteuerung
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testbericht-an-den-online-dienst-pastebin-senden" class="md-nav__link">
    <span class="md-ellipsis">
      Testbericht an den Online-Dienst pastebin senden
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tests-schreiben" class="md-nav__link">
    <span class="md-ellipsis">
      Tests schreiben
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tests schreiben">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parametrisierung" class="md-nav__link">
    <span class="md-ellipsis">
      Parametrisierung
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dateien-und-verzeichnisse" class="md-nav__link">
    <span class="md-ellipsis">
      Dateien und Verzeichnisse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#temporare-dateien-und-verzeichnisse" class="md-nav__link">
    <span class="md-ellipsis">
      Tempor√§re Dateien und Verzeichnisse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#temporare-uberschreibung-von-syspath" class="md-nav__link">
    <span class="md-ellipsis">
      Tempor√§re √úberschreibung von sys.path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uberspringen-von-tests" class="md-nav__link">
    <span class="md-ellipsis">
      √úberspringen von Tests
    </span>
  </a>
  
    <nav class="md-nav" aria-label="√úberspringen von Tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementierung" class="md-nav__link">
    <span class="md-ellipsis">
      Implementierung
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testen-der-stdoutstderr-ausgabe" class="md-nav__link">
    <span class="md-ellipsis">
      Testen der stdout/stderr-Ausgabe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#erfassen-von-logger-streams" class="md-nav__link">
    <span class="md-ellipsis">
      Erfassen von Logger-Streams
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testen-mit-umgebungsvariablen" class="md-nav__link">
    <span class="md-ellipsis">
      Testen mit Umgebungsvariablen
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reproduzierbare-ergebnisse-erhalten" class="md-nav__link">
    <span class="md-ellipsis">
      Reproduzierbare Ergebnisse erhalten
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tests-debuggen" class="md-nav__link">
    <span class="md-ellipsis">
      Tests debuggen
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#arbeiten-mit-github-aktionen-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      Arbeiten mit Github-Aktionen-Workflows
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testen-experimenteller-ci-funktionen" class="md-nav__link">
    <span class="md-ellipsis">
      Testen experimenteller CI-Funktionen
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<!--Copyright 2020 The HuggingFace Team. All rights reserved.

Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with
the License. You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
specific language governing permissions and limitations under the License.

‚ö†Ô∏è Note that this file is in Markdown but contain specific syntax for our doc-builder (similar to MDX) that may not be
rendered properly in your Markdown viewer.

-->

<h1 id="testen">Testen</h1>
<p>Werfen wir einen Blick darauf, wie ü§ó Transformers-Modelle getestet werden und wie Sie neue Tests schreiben und die vorhandenen verbessern k√∂nnen.</p>
<p>Es gibt 2 Testsuiten im Repository:</p>
<ol>
<li><code>tests</code> -- Tests f√ºr die allgemeine API</li>
<li><code>examples</code> -- Tests haupts√§chlich f√ºr verschiedene Anwendungen, die nicht Teil der API sind</li>
</ol>
<h2 id="wie-transformatoren-getestet-werden">Wie Transformatoren getestet werden</h2>
<ol>
<li>Sobald ein PR eingereicht wurde, wird er mit 9 CircleCi Jobs getestet. Jeder neue Commit zu diesem PR wird erneut getestet. Diese Auftr√§ge
   sind in dieser <a href="https://github.com/huggingface/transformers/tree/main/.circleci/config.yml">Konfigurationsdatei</a> definiert, so dass Sie bei Bedarf die gleiche Umgebung auf Ihrem Rechner reproduzieren k√∂nnen.
   Umgebung auf Ihrem Rechner reproduzieren k√∂nnen.</li>
</ol>
<p>Diese CI-Jobs f√ºhren keine <code>@slow</code>-Tests durch.</p>
<ol>
<li>
<p>Es gibt 3 Jobs, die von <a href="https://github.com/huggingface/transformers/actions">github actions</a> ausgef√ºhrt werden:</p>
</li>
<li>
<p><a href="https://github.com/huggingface/transformers/tree/main/.github/workflows/github-torch-hub.yml">torch hub integration</a>: pr√ºft, ob die torch hub
     Integration funktioniert.</p>
</li>
<li>
<p><a href="https://github.com/huggingface/transformers/tree/main/.github/workflows/self-push.yml">self-hosted (push)</a>: f√ºhrt schnelle Tests auf der GPU nur bei Commits auf
     <code>main</code>. Es wird nur ausgef√ºhrt, wenn ein Commit auf <code>main</code> den Code in einem der folgenden Ordner aktualisiert hat: <code>src</code>,
     <code>tests</code>, <code>.github</code> (um zu verhindern, dass er auf hinzugef√ºgten Modellkarten, Notebooks usw. l√§uft)</p>
</li>
<li>
<p><a href="https://github.com/huggingface/transformers/tree/main/.github/workflows/self-scheduled.yml">self-hosted runner</a>: f√ºhrt normale und langsame Tests auf GPU in
     <code>tests</code> und <code>examples</code>:</p>
</li>
</ol>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nv">RUN_SLOW</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>pytest<span class="w"> </span>tests/
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nv">RUN_SLOW</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>pytest<span class="w"> </span>examples/
</span></code></pre></div>
<p>Die Ergebnisse k√∂nnen Sie <a href="https://github.com/huggingface/transformers/actions">hier</a> sehen.</p>
<h2 id="tests-ausfuhren">Tests ausf√ºhren</h2>
<h3 id="auswahl-der-auszufuhrenden-tests">Auswahl der auszuf√ºhrenden Tests</h3>
<p>In diesem Dokument wird ausf√ºhrlich erl√§utert, wie Tests ausgef√ºhrt werden k√∂nnen. Wenn Sie nach der Lekt√ºre noch mehr Details ben√∂tigen
finden Sie diese <a href="https://docs.pytest.org/en/latest/usage.html">hier</a>.</p>
<p>Hier sind einige der n√ºtzlichsten M√∂glichkeiten, Tests auszuf√ºhren.</p>
<p>Alle ausf√ºhren:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="go">pytest</span>
</span></code></pre></div>
<p>oder:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>make<span class="w"> </span><span class="nb">test</span>
</span></code></pre></div>
<p>Beachten Sie, dass Letzteres wie folgt definiert ist:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>python<span class="w"> </span>-m<span class="w"> </span>pytest<span class="w"> </span>-n<span class="w"> </span>auto<span class="w"> </span>--dist<span class="o">=</span>loadfile<span class="w"> </span>-s<span class="w"> </span>-v<span class="w"> </span>./tests/
</span></code></pre></div>
<p>was pytest anweist:</p>
<ul>
<li>so viele Testprozesse laufen zu lassen, wie es CPU-Kerne gibt (was zu viele sein k√∂nnten, wenn Sie nicht √ºber eine Menge RAM verf√ºgen!)</li>
<li>sicherzustellen, dass alle Tests aus derselben Datei von demselben Testprozess ausgef√ºhrt werden</li>
<li>Erfassen Sie keine Ausgaben</li>
<li>im ausf√ºhrlichen Modus laufen lassen</li>
</ul>
<h3 id="abrufen-der-liste-aller-tests">Abrufen der Liste aller Tests</h3>
<p>Alle Tests der Testsuite:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>pytest<span class="w"> </span>--collect-only<span class="w"> </span>-q
</span></code></pre></div>
<p>Alle Tests einer bestimmten Testdatei:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>pytest<span class="w"> </span>tests/test_optimization.py<span class="w"> </span>--collect-only<span class="w"> </span>-q
</span></code></pre></div>
<h3 id="fuhren-sie-ein-bestimmtes-testmodul-aus">F√ºhren Sie ein bestimmtes Testmodul aus</h3>
<p>Um ein einzelnes Testmodul auszuf√ºhren:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>pytest<span class="w"> </span>tests/utils/test_logging.py
</span></code></pre></div>
<h3 id="spezifische-tests-ausfuhren">Spezifische Tests ausf√ºhren</h3>
<p>Da unittest in den meisten Tests verwendet wird, m√ºssen Sie, um bestimmte Untertests auszuf√ºhren, den Namen der unittest
Klasse, die diese Tests enth√§lt. Er k√∂nnte zum Beispiel lauten:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>pytest<span class="w"> </span>tests/test_optimization.py::OptimizationTest::test_adam_w
</span></code></pre></div>
<p>Hier:</p>
<ul>
<li><code>tests/test_optimization.py</code> - die Datei mit den Tests</li>
<li><code>OptimizationTest</code> - der Name der Klasse</li>
<li><code>test_adam_w</code> - der Name der spezifischen Testfunktion</li>
</ul>
<p>Wenn die Datei mehrere Klassen enth√§lt, k√∂nnen Sie ausw√§hlen, dass nur die Tests einer bestimmten Klasse ausgef√ºhrt werden sollen. Zum Beispiel:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>pytest<span class="w"> </span>tests/test_optimization.py::OptimizationTest
</span></code></pre></div>
<p>f√ºhrt alle Tests innerhalb dieser Klasse aus.</p>
<p>Wie bereits erw√§hnt, k√∂nnen Sie sehen, welche Tests in der Klasse <code>OptimizationTest</code> enthalten sind, indem Sie sie ausf√ºhren:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>pytest<span class="w"> </span>tests/test_optimization.py::OptimizationTest<span class="w"> </span>--collect-only<span class="w"> </span>-q
</span></code></pre></div>
<p>Sie k√∂nnen Tests mit Hilfe von Schl√ºsselwortausdr√ºcken ausf√ºhren.</p>
<p>Um nur Tests auszuf√ºhren, deren Name <code>adam</code> enth√§lt:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>pytest<span class="w"> </span>-k<span class="w"> </span>adam<span class="w"> </span>tests/test_optimization.py
</span></code></pre></div>
<p>Die logischen <code>und</code> und <code>oder</code> k√∂nnen verwendet werden, um anzugeben, ob alle Schl√ºsselw√∂rter √ºbereinstimmen sollen oder nur eines. <code>nicht</code> kann verwendet werden, um
negieren.</p>
<p>Um alle Tests auszuf√ºhren, au√üer denen, deren Name <code>adam</code> enth√§lt:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>pytest<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;not adam&quot;</span><span class="w"> </span>tests/test_optimization.py
</span></code></pre></div>
<p>Und Sie k√∂nnen die beiden Muster in einem kombinieren:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>pytest<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;ada and not adam&quot;</span><span class="w"> </span>tests/test_optimization.py
</span></code></pre></div>
<p>Um zum Beispiel sowohl <code>test_adafactor</code> als auch <code>test_adam_w</code> auszuf√ºhren, k√∂nnen Sie verwenden:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>pytest<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;test_adam_w or test_adam_w&quot;</span><span class="w"> </span>tests/test_optimization.py
</span></code></pre></div>
<p>Beachten Sie, dass wir hier <code>oder</code> verwenden, da wir wollen, dass eines der Schl√ºsselw√∂rter √ºbereinstimmt, um beide einzuschlie√üen.</p>
<p>Wenn Sie nur Tests einschlie√üen m√∂chten, die beide Muster enthalten, m√ºssen Sie <code>und</code> verwenden:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>pytest<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;test and ada&quot;</span><span class="w"> </span>tests/test_optimization.py
</span></code></pre></div>
<h3 id="fuhren-sie-accelerate-tests-durch">F√ºhren Sie <code>accelerate</code> Tests durch</h3>
<p>Manchmal m√ºssen Sie <code>accelerate</code> Tests f√ºr Ihre Modelle ausf√ºhren. Dazu f√ºgen Sie einfach <code>-m accelerate_tests</code> zu Ihrem Befehl hinzu, wenn Sie diese Tests bei einem <code>OPT</code>-Lauf ausf√ºhren m√∂chten:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nv">RUN_SLOW</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>pytest<span class="w"> </span>-m<span class="w"> </span>accelerate_tests<span class="w"> </span>tests/models/opt/test_modeling_opt.py
</span></code></pre></div></p>
<h3 id="dokumentationstests-ausfuhren">Dokumentationstests ausf√ºhren</h3>
<p>Um zu testen, ob die Dokumentationsbeispiele korrekt sind, sollten Sie √ºberpr√ºfen, ob die <code>doctests</code> erfolgreich sind.
Lassen Sie uns als Beispiel den docstring von <a href="https://github.com/huggingface/transformers/blob/main/src/transformers/models/whisper/modeling_whisper.py#L1017-L1035">WhisperModel.forward</a> verwenden:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="sd">Returns:</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="sd">Example:</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="sd">    ```python</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="sd">    &gt;&gt;&gt; import torch</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="sd">    &gt;&gt;&gt; from transformers import WhisperModel, WhisperFeatureExtractor</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="sd">    &gt;&gt;&gt; from datasets import load_dataset</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="sd">    &gt;&gt;&gt; model = WhisperModel.from_pretrained(&quot;openai/whisper-base&quot;)</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="sd">    &gt;&gt;&gt; feature_extractor = WhisperFeatureExtractor.from_pretrained(&quot;openai/whisper-base&quot;)</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="sd">    &gt;&gt;&gt; ds = load_dataset(&quot;hf-internal-testing/librispeech_asr_dummy&quot;, &quot;clean&quot;, split=&quot;validation&quot;)</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="sd">    &gt;&gt;&gt; inputs = feature_extractor(ds[0][&quot;audio&quot;][&quot;array&quot;], return_tensors=&quot;pt&quot;)</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="sd">    &gt;&gt;&gt; input_features = inputs.input_features</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="sd">    &gt;&gt;&gt; decoder_input_ids = torch.tensor([[1, 1]]) * model.config.decoder_start_token_id</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="sd">    &gt;&gt;&gt; last_hidden_state = model(input_features, decoder_input_ids=decoder_input_ids).last_hidden_state</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="sd">    &gt;&gt;&gt; list(last_hidden_state.shape)</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="sd">    [1, 2, 512]</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="sd">    ```&quot;&quot;&quot;</span>
</span></code></pre></div>
<p>F√ºhren Sie einfach die folgende Zeile aus, um automatisch jedes docstring-Beispiel in der gew√ºnschten Datei zu testen:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>pytest<span class="w"> </span>--doctest-modules<span class="w"> </span>&lt;path_to_file_or_dir&gt;
</span></code></pre></div>
Wenn die Datei eine Markdown-Erweiterung hat, sollten Sie das Argument <code>--doctest-glob="*.md"</code> hinzuf√ºgen.</p>
<h3 id="nur-geanderte-tests-ausfuhren">Nur ge√§nderte Tests ausf√ºhren</h3>
<p>Mit <a href="https://github.com/anapaulagomes/pytest-picked">pytest-picked</a> k√∂nnen Sie die Tests ausf√ºhren, die sich auf die unstaged Dateien oder den aktuellen Zweig (gem√§√ü Git) beziehen. Auf diese Weise k√∂nnen Sie schnell testen, ob Ihre √Ñnderungen nichts kaputt gemacht haben.
nichts kaputt gemacht haben, da die Tests f√ºr Dateien, die Sie nicht ver√§ndert haben, nicht ausgef√ºhrt werden.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>pip<span class="w"> </span>install<span class="w"> </span>pytest-picked
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>pytest<span class="w"> </span>--picked
</span></code></pre></div>
<p>Alle Tests werden von Dateien und Ordnern ausgef√ºhrt, die ge√§ndert, aber noch nicht √ºbergeben wurden.</p>
<h3 id="fehlgeschlagene-tests-bei-anderung-der-quelle-automatisch-wiederholen">Fehlgeschlagene Tests bei √Ñnderung der Quelle automatisch wiederholen</h3>
<p><a href="https://github.com/pytest-dev/pytest-xdist">pytest-xdist</a> bietet eine sehr n√ºtzliche Funktion zur Erkennung aller fehlgeschlagenen
Tests zu erkennen und dann darauf zu warten, dass Sie Dateien √§ndern, um die fehlgeschlagenen Tests so lange zu wiederholen, bis sie erfolgreich sind, w√§hrend Sie die
sie reparieren. So m√ºssen Sie pytest nicht erneut starten, nachdem Sie die Korrektur vorgenommen haben. Dies wird so lange wiederholt, bis alle Tests bestanden sind.
Danach wird erneut ein vollst√§ndiger Durchlauf durchgef√ºhrt.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>pip<span class="w"> </span>install<span class="w"> </span>pytest-xdist
</span></code></pre></div>
<p>So rufen Sie den Modus auf: <code>pytest -f</code> oder <code>pytest --looponfail</code></p>
<p>Datei-√Ñnderungen werden erkannt, indem die Wurzelverzeichnisse von <code>looponfailroots</code> und alle ihre Inhalte (rekursiv) untersucht werden.
Wenn die Vorgabe f√ºr diesen Wert f√ºr Sie nicht funktioniert, k√∂nnen Sie ihn in Ihrem Projekt √§ndern, indem Sie eine Konfigurations
Option in der Datei <code>setup.cfg</code> √§ndern:</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">[tool:pytest]</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="na">looponfailroots</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">transformers tests</span>
</span></code></pre></div>
<p>oder die Dateien <code>pytest.ini</code>/`tox.ini``:</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="k">[pytest]</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="na">looponfailroots</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">transformers tests</span>
</span></code></pre></div>
<p>Dies w√ºrde dazu f√ºhren, dass nur nach Datei√§nderungen in den jeweiligen Verzeichnissen gesucht wird, die relativ zum Verzeichnis der ini-Datei angegeben sind.
Verzeichnis.</p>
<p><a href="https://github.com/joeyespo/pytest-watch">pytest-watch</a> ist eine alternative Implementierung dieser Funktionalit√§t.</p>
<h3 id="uberspringen-eines-testmoduls">√úberspringen eines Testmoduls</h3>
<p>Wenn Sie alle Testmodule ausf√ºhren m√∂chten, mit Ausnahme einiger weniger, k√∂nnen Sie diese ausschlie√üen, indem Sie eine explizite Liste der auszuf√ºhrenden Tests angeben. F√ºr
Beispiel: Um alle Tests au√üer <code>test_modeling_*.py</code> auszuf√ºhren:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>pytest<span class="w"> </span>*ls<span class="w"> </span>-1<span class="w"> </span>tests/*py<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span>test_modeling*
</span></code></pre></div>
<h3 id="status-leeren">Status leeren</h3>
<p>CI-Builds und wenn Isolation wichtig ist (gegen Geschwindigkeit), sollte der Cache geleert werden:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>pytest<span class="w"> </span>--cache-clear<span class="w"> </span>tests
</span></code></pre></div>
<h3 id="tests-parallel-ausfuhren">Tests parallel ausf√ºhren</h3>
<p>Wie bereits erw√§hnt, f√ºhrt <code>make test</code> √ºber das Plugin <code>pytest-xdist</code> Tests parallel aus (Argument <code>-n X</code>, z.B. <code>-n 2</code>
um 2 Jobs parallel laufen zu lassen).</p>
<p>Mit der Option <code>--dist=</code> von <code>pytest-xdist</code> k√∂nnen Sie steuern, wie die Tests gruppiert werden. Mit <code>--dist=loadfile</code> werden die
Tests, die sich in einer Datei befinden, in denselben Prozess.</p>
<p>Da die Reihenfolge der ausgef√ºhrten Tests unterschiedlich und nicht vorhersehbar ist, kann die Ausf√ºhrung der Testsuite mit <code>pytest-xdist</code>
zu Fehlern f√ºhrt (was bedeutet, dass wir einige unentdeckte gekoppelte Tests haben), verwenden Sie <a href="https://github.com/ESSS/pytest-replay">pytest-replay</a>, um die Tests in der gleichen Reihenfolge abzuspielen, was dabei helfen sollte
diese fehlgeschlagene Sequenz auf ein Minimum zu reduzieren.</p>
<h3 id="testreihenfolge-und-wiederholung">Testreihenfolge und Wiederholung</h3>
<p>Es ist gut, die Tests mehrmals zu wiederholen, nacheinander, zuf√§llig oder in Gruppen, um m√∂gliche
Abh√§ngigkeiten und zustandsbezogene Fehler zu erkennen (Abriss). Und die einfache, mehrfache Wiederholung ist einfach gut, um
einige Probleme zu erkennen, die durch die Zuf√§lligkeit von DL aufgedeckt werden.</p>
<h4 id="wiederholungstests">Wiederholungstests</h4>
<ul>
<li><a href="https://github.com/dropbox/pytest-flakefinder">pytest-flakefinder</a>:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>pip<span class="w"> </span>install<span class="w"> </span>pytest-flakefinder
</span></code></pre></div>
<p>Und f√ºhren Sie dann jeden Test mehrmals durch (standardm√§√üig 50):</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>pytest<span class="w"> </span>--flake-finder<span class="w"> </span>--flake-runs<span class="o">=</span><span class="m">5</span><span class="w"> </span>tests/test_failing_test.py
</span></code></pre></div>
<p><Tip></p>
<p>Dieses Plugin funktioniert nicht mit dem <code>-n</code> Flag von <code>pytest-xdist</code>.</p>
<p></Tip></p>
<p><Tip></p>
<p>Es gibt noch ein anderes Plugin <code>pytest-repeat</code>, aber es funktioniert nicht mit <code>unittest</code>.</p>
<p></Tip></p>
<h4 id="run-tests-in-a-random-order">Run tests in a random order</h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>pip<span class="w"> </span>install<span class="w"> </span>pytest-random-order
</span></code></pre></div>
<p>Wichtig: Das Vorhandensein von <code>pytest-random-order</code> sorgt f√ºr eine automatische Zufallsanordnung der Tests, es sind keine Konfigurations√§nderungen oder
Befehlszeilenoptionen sind nicht erforderlich.</p>
<p>Wie bereits erl√§utert, erm√∂glicht dies die Erkennung von gekoppelten Tests - bei denen der Zustand eines Tests den Zustand eines anderen beeinflusst. Wenn
<code>pytest-random-order</code> installiert ist, gibt es den Zufallswert aus, der f√ºr diese Sitzung verwendet wurde, z.B:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>pytest<span class="w"> </span>tests
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="o">[</span>...<span class="o">]</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>Using<span class="w"> </span>--random-order-bucket<span class="o">=</span>module
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>Using<span class="w"> </span>--random-order-seed<span class="o">=</span><span class="m">573663</span>
</span></code></pre></div>
<p>Wenn eine bestimmte Sequenz fehlschl√§gt, k√∂nnen Sie sie reproduzieren, indem Sie genau diesen Seed hinzuf√ºgen, z.B:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>pytest<span class="w"> </span>--random-order-seed<span class="o">=</span><span class="m">573663</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="o">[</span>...<span class="o">]</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>Using<span class="w"> </span>--random-order-bucket<span class="o">=</span>module
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>Using<span class="w"> </span>--random-order-seed<span class="o">=</span><span class="m">573663</span>
</span></code></pre></div>
<p>Es wird nur dann die exakte Reihenfolge reproduzieren, wenn Sie genau dieselbe Liste von Tests (oder gar keine Liste) verwenden. Sobald Sie beginnen, die Liste
die Liste manuell einzugrenzen, k√∂nnen Sie sich nicht mehr auf den Seed verlassen, sondern m√ºssen die Tests manuell in der genauen Reihenfolge auflisten
auflisten und pytest anweisen, sie nicht zu randomisieren, indem Sie <code>--random-order-bucket=none</code> verwenden, z.B.:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>pytest<span class="w"> </span>--random-order-bucket<span class="o">=</span>none<span class="w"> </span>tests/test_a.py<span class="w"> </span>tests/test_c.py<span class="w"> </span>tests/test_b.py
</span></code></pre></div>
<p>So deaktivieren Sie das Shuffling f√ºr alle Tests:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>pytest<span class="w"> </span>--random-order-bucket<span class="o">=</span>none
</span></code></pre></div>
<p>Standardm√§√üig ist <code>--random-order-bucket=module</code> impliziert, wodurch die Dateien auf den Modulebenen gemischt werden. Es kann auch
auf den Ebenen <code>class</code>, <code>package</code>, <code>global</code> und <code>none</code> mischen. Die vollst√§ndigen Details entnehmen Sie bitte der
<a href="https://github.com/jbasko/pytest-random-order">Dokumentation</a>.</p>
<p>Eine weitere Alternative zur Randomisierung ist: <a href="https://github.com/pytest-dev/pytest-randomly"><code>pytest-random</code></a>. Dieses
Modul hat eine sehr √§hnliche Funktionalit√§t/Schnittstelle, aber es hat nicht die Eimermodi, die in
<code>pytest-random-order</code> zur Verf√ºgung. Es hat das gleiche Problem, dass es sich nach der Installation aufdr√§ngt.</p>
<h3 id="variationen-von-aussehen-und-bedienung">Variationen von Aussehen und Bedienung</h3>
<h4 id="pytest-zucker">pytest-zucker</h4>
<p><a href="https://github.com/Frozenball/pytest-sugar">pytest-sugar</a> ist ein Plugin, das das Erscheinungsbild verbessert, eine
Fortschrittsbalken hinzuf√ºgt und Tests, die fehlschlagen, sowie die Best√§tigung sofort anzeigt. Es wird bei der Installation automatisch aktiviert.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>pip<span class="w"> </span>install<span class="w"> </span>pytest-sugar
</span></code></pre></div>
<p>Um Tests ohne sie durchzuf√ºhren, f√ºhren Sie aus:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>pytest<span class="w"> </span>-p<span class="w"> </span>no:sugar
</span></code></pre></div>
<p>oder deinstallieren Sie es.</p>
<h4 id="melden-sie-den-namen-jedes-subtests-und-seinen-fortschritt">Melden Sie den Namen jedes Subtests und seinen Fortschritt</h4>
<p>F√ºr einen einzelnen oder eine Gruppe von Tests √ºber <code>pytest</code> (nach <code>pip install pytest-pspec</code>):</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>pytest<span class="w"> </span>--pspec<span class="w"> </span>tests/test_optimization.py
</span></code></pre></div>
<h4 id="zeigt-fehlgeschlagene-tests-sofort-an">Zeigt fehlgeschlagene Tests sofort an</h4>
<p><a href="https://github.com/pytest-dev/pytest-instafail">pytest-instafail</a> zeigt Fehlschl√§ge und Fehler sofort an, anstatt
bis zum Ende der Testsitzung zu warten.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>pip<span class="w"> </span>install<span class="w"> </span>pytest-instafail
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>pytest<span class="w"> </span>--instafail
</span></code></pre></div>
<h3 id="zu-gpu-oder-nicht-zu-gpu">Zu GPU oder nicht zu GPU</h3>
<p>Bei einem GPU-aktivierten Setup f√ºgen Sie zum Testen im reinen CPU-Modus <code>CUDA_VISIBLE_DEVICES=""</code> hinzu:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="w"> </span>pytest<span class="w"> </span>tests/utils/test_logging.py
</span></code></pre></div>
<p>oder wenn Sie mehrere Grafikprozessoren haben, k√∂nnen Sie angeben, welcher von <code>pytest</code> verwendet werden soll. Wenn Sie zum Beispiel nur den
zweiten Grafikkarte zu verwenden, wenn Sie die Grafikkarten <code>0</code> und <code>1</code> haben, k√∂nnen Sie folgendes ausf√ºhren:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="w"> </span>pytest<span class="w"> </span>tests/utils/test_logging.py
</span></code></pre></div>
<p>Dies ist praktisch, wenn Sie verschiedene Aufgaben auf verschiedenen GPUs ausf√ºhren m√∂chten.</p>
<p>Einige Tests m√ºssen nur auf der CPU ausgef√ºhrt werden, andere entweder auf der CPU, der GPU oder der TPU und wieder andere auf mehreren GPUs. Die folgenden skip
Dekorateure werden verwendet, um die Anforderungen von Tests in Bezug auf CPU/GPU/TPU festzulegen:</p>
<ul>
<li><code>require_torch</code> - dieser Test wird nur unter Torch ausgef√ºhrt</li>
<li><code>require_torch_gpu</code> - wie <code>require_torch</code> plus erfordert mindestens 1 GPU</li>
<li><code>require_torch_multi_gpu</code> - wie <code>require_torch</code> und zus√§tzlich mindestens 2 GPUs erforderlich</li>
<li><code>require_torch_non_multi_gpu</code> - wie <code>require_torch</code> plus ben√∂tigt 0 oder 1 GPUs</li>
<li><code>require_torch_up_to_2_gpus</code> - wie <code>require_torch</code> plus erfordert 0 oder 1 oder 2 GPUs</li>
<li><code>require_torch_xla</code> - wie <code>require_torch</code> plus erfordert mindestens 1 TPU</li>
</ul>
<p>Lassen Sie uns die GPU-Anforderungen in der folgenden Tabelle darstellen:</p>
<table>
<thead>
<tr>
<th>n gpus</th>
<th>decorator</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&gt;= 0</code></td>
<td><code>@require_torch</code></td>
</tr>
<tr>
<td><code>&gt;= 1</code></td>
<td><code>@require_torch_gpu</code></td>
</tr>
<tr>
<td><code>&gt;= 2</code></td>
<td><code>@require_torch_multi_gpu</code></td>
</tr>
<tr>
<td><code>&lt; 2</code></td>
<td><code>@require_torch_non_multi_gpu</code></td>
</tr>
<tr>
<td><code>&lt; 3</code></td>
<td><code>@require_torch_up_to_2_gpus</code></td>
</tr>
</tbody>
</table>
<p>Hier ist zum Beispiel ein Test, der nur ausgef√ºhrt werden muss, wenn 2 oder mehr GPUs verf√ºgbar sind und pytorch installiert ist:</p>
<p>```python no-style
@require_torch_multi_gpu
def test_example_with_multi_gpu():
<div class="language-bash highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>Diese<span class="w"> </span>Dekors<span class="w"> </span>k√∂nnen<span class="w"> </span>gestapelt<span class="w"> </span>werden.<span class="w"> </span>Wenn<span class="w"> </span>zum<span class="w"> </span>Beispiel<span class="w"> </span>ein<span class="w"> </span>Test<span class="w"> </span>langsam<span class="w"> </span>ist<span class="w"> </span>und<span class="w"> </span>mindestens<span class="w"> </span>eine<span class="w"> </span>GPU<span class="w"> </span>unter<span class="w"> </span>pytorch<span class="w"> </span>ben√∂tigt,<span class="w"> </span>k√∂nnen<span class="w"> </span>Sie
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>wie<span class="w"> </span>Sie<span class="w"> </span>ihn<span class="w"> </span>einrichten<span class="w"> </span>k√∂nnen:
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="sb">```</span>python<span class="w"> </span>no-style
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a>@require_torch_gpu
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a>@slow
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a>def<span class="w"> </span>test_example_slow_on_gpu<span class="o">()</span>:
</span></code></pre></div></p>
<p>Einige Dekoratoren wie <code>@parametrized</code> schreiben Testnamen um, daher m√ºssen <code>@require_*</code>-Sprungdekoratoren als letztes aufgef√ºhrt werden.
zuletzt aufgef√ºhrt werden, damit sie korrekt funktionieren. Hier ist ein Beispiel f√ºr die korrekte Verwendung:</p>
<p>```python no-style
@parameterized.expand(...)
@require_torch_multi_gpu
def test_integration_foo():
<div class="language-bash highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>Dieses<span class="w"> </span>Problem<span class="w"> </span>mit<span class="w"> </span>der<span class="w"> </span>Reihenfolge<span class="w"> </span>gibt<span class="w"> </span>es<span class="w"> </span>bei<span class="w"> </span><span class="sb">`</span>@pytest.mark.parametrize<span class="sb">`</span><span class="w"> </span>nicht,<span class="w"> </span>Sie<span class="w"> </span>k√∂nnen<span class="w"> </span>es<span class="w"> </span>an<span class="w"> </span>den<span class="w"> </span>Anfang<span class="w"> </span>oder<span class="w"> </span>an<span class="w"> </span>den<span class="w"> </span>Schluss<span class="w"> </span>setzen<span class="w"> </span>und<span class="w"> </span>es<span class="w"> </span>wird<span class="w"> </span>trotzdem<span class="w"> </span>funktionieren.
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>funktionieren.<span class="w"> </span>Aber<span class="w"> </span>es<span class="w"> </span>funktioniert<span class="w"> </span>nur<span class="w"> </span>bei<span class="w"> </span>Nicht-Unittests.
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>Innerhalb<span class="w"> </span>von<span class="w"> </span>Tests:
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>-<span class="w"> </span>Wie<span class="w"> </span>viele<span class="w"> </span>GPUs<span class="w"> </span>sind<span class="w"> </span>verf√ºgbar:
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="sb">```</span>python
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>from<span class="w"> </span>transformers.testing_utils<span class="w"> </span>import<span class="w"> </span>get_gpu_count
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="nv">n_gpu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>get_gpu_count<span class="o">()</span><span class="w">  </span><span class="c1"># works with torch and tf</span>
</span></code></pre></div></p>
<h3 id="testen-mit-einem-bestimmten-pytorch-backend-oder-gerat">Testen mit einem bestimmten PyTorch-Backend oder Ger√§t</h3>
<p>Um die Testsuite auf einem bestimmten Torch-Ger√§t auszuf√ºhren, f√ºgen Sie <code>TRANSFORMERS_TEST_DEVICE="$Ger√§t"</code> hinzu, wobei <code>$Ger√§t</code> das Ziel-Backend ist. Zum Beispiel, um nur auf der CPU zu testen:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="nv">TRANSFORMERS_TEST_DEVICE</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="w"> </span>pytest<span class="w"> </span>tests/utils/test_logging.py
</span></code></pre></div></p>
<p>Diese Variable ist n√ºtzlich, um benutzerdefinierte oder weniger verbreitete PyTorch-Backends wie <code>mps</code> zu testen. Sie kann auch verwendet werden, um den gleichen Effekt wie <code>CUDA_VISIBLE_DEVICES</code> zu erzielen, indem Sie bestimmte GPUs anvisieren oder im reinen CPU-Modus testen.</p>
<p>Bestimmte Ger√§te erfordern einen zus√§tzlichen Import, nachdem Sie <code>torch</code> zum ersten Mal importiert haben. Dies kann √ºber die Umgebungsvariable <code>TRANSFORMERS_TEST_BACKEND</code> festgelegt werden:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="nv">TRANSFORMERS_TEST_BACKEND</span><span class="o">=</span><span class="s2">&quot;torch_npu&quot;</span><span class="w"> </span>pytest<span class="w"> </span>tests/utils/test_logging.py
</span></code></pre></div></p>
<h3 id="verteiltes-training">Verteiltes Training</h3>
<p><code>pytest</code> kann nicht direkt mit verteiltem Training umgehen. Wenn dies versucht wird, tun die Unterprozesse nicht das Richtige
und denken am Ende, sie seien <code>pytest</code> und beginnen, die Testsuite in Schleifen auszuf√ºhren. Es funktioniert jedoch, wenn man
einen normalen Prozess erzeugt, der dann mehrere Worker erzeugt und die IO-Pipes verwaltet.</p>
<p>Hier sind einige Tests, die dies verwenden:</p>
<ul>
<li><a href="https://github.com/huggingface/transformers/tree/main/tests/trainer/test_trainer_distributed.py">test_trainer_distributed.py</a></li>
<li><a href="https://github.com/huggingface/transformers/tree/main/tests/deepspeed/test_deepspeed.py">test_deepspeed.py</a></li>
</ul>
<p>Um direkt mit der Ausf√ºhrung zu beginnen, suchen Sie in diesen Tests nach dem Aufruf <code>execute_subprocess_async</code>.</p>
<p>Sie ben√∂tigen mindestens 2 GPUs, um diese Tests in Aktion zu sehen:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span>,1<span class="w"> </span><span class="nv">RUN_SLOW</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>pytest<span class="w"> </span>-sv<span class="w"> </span>tests/test_trainer_distributed.py
</span></code></pre></div>
<h3 id="erfassung-von-ausgaben">Erfassung von Ausgaben</h3>
<p>W√§hrend der Testausf√ºhrung werden alle Ausgaben, die an <code>stdout</code> und <code>stderr</code> gesendet werden, aufgezeichnet. Wenn ein Test oder eine Setup-Methode fehlschl√§gt, wird die
wird die entsprechende aufgezeichnete Ausgabe in der Regel zusammen mit dem Fehler-Traceback angezeigt.</p>
<p>Um die Aufzeichnung von Ausgaben zu deaktivieren und <code>stdout</code> und <code>stderr</code> normal zu erhalten, verwenden Sie <code>-s</code> oder <code>--capture=no</code>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>pytest<span class="w"> </span>-s<span class="w"> </span>tests/utils/test_logging.py
</span></code></pre></div>
<p>So senden Sie Testergebnisse an die JUnit-Formatausgabe:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>py.test<span class="w"> </span>tests<span class="w"> </span>--junitxml<span class="o">=</span>result.xml
</span></code></pre></div>
<h3 id="farbsteuerung">Farbsteuerung</h3>
<p>Keine Farbe zu haben (z.B. gelb auf wei√üem Hintergrund ist nicht lesbar):</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>pytest<span class="w"> </span>--color<span class="o">=</span>no<span class="w"> </span>tests/utils/test_logging.py
</span></code></pre></div>
<h3 id="testbericht-an-den-online-dienst-pastebin-senden">Testbericht an den Online-Dienst pastebin senden</h3>
<p>Erstellen Sie eine URL f√ºr jeden Testfehler:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>pytest<span class="w"> </span>--pastebin<span class="o">=</span>failed<span class="w"> </span>tests/utils/test_logging.py
</span></code></pre></div>
<p>Dadurch werden Informationen √ºber den Testlauf an einen entfernten Paste-Dienst √ºbermittelt und eine URL f√ºr jeden Fehlschlag bereitgestellt. Sie k√∂nnen die
Tests wie gewohnt ausw√§hlen oder z.B. -x hinzuf√ºgen, wenn Sie nur einen bestimmten Fehler senden m√∂chten.</p>
<p>Erstellen einer URL f√ºr ein ganzes Testsitzungsprotokoll:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>pytest<span class="w"> </span>--pastebin<span class="o">=</span>all<span class="w"> </span>tests/utils/test_logging.py
</span></code></pre></div>
<h2 id="tests-schreiben">Tests schreiben</h2>
<p>ü§ó Die Tests von Transformers basieren auf <code>unittest</code>, werden aber von <code>pytest</code> ausgef√ºhrt, so dass die meiste Zeit Funktionen aus beiden Systemen
verwendet werden k√∂nnen.</p>
<p>Sie k√∂nnen <a href="https://docs.pytest.org/en/stable/unittest.html">hier</a> nachlesen, welche Funktionen unterst√ºtzt werden, aber das Wichtigste ist
Wichtig ist, dass die meisten <code>pytest</code>-Fixtures nicht funktionieren. Auch die Parametrisierung nicht, aber wir verwenden das Modul
<code>parametrisiert</code>, das auf √§hnliche Weise funktioniert.</p>
<h3 id="parametrisierung">Parametrisierung</h3>
<p>Oft besteht die Notwendigkeit, denselben Test mehrmals auszuf√ºhren, aber mit unterschiedlichen Argumenten. Das k√∂nnte innerhalb des Tests geschehen
des Tests gemacht werden, aber dann gibt es keine M√∂glichkeit, den Test mit nur einem Satz von Argumenten auszuf√ºhren.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="c1"># test_this1.py</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">unittest</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">parameterized</span><span class="w"> </span><span class="kn">import</span> <span class="n">parameterized</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">TestMathUnitTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a>    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a>        <span class="p">[</span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a>            <span class="p">(</span><span class="s2">&quot;negative&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">),</span>
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a>            <span class="p">(</span><span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a>            <span class="p">(</span><span class="s2">&quot;large fraction&quot;</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-49-12"><a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a>        <span class="p">]</span>
</span><span id="__span-49-13"><a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a>    <span class="p">)</span>
</span><span id="__span-49-14"><a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_floor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
</span><span id="__span-49-15"><a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a>        <span class="n">assert_equal</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">input</span><span class="p">),</span> <span class="n">expected</span><span class="p">)</span>
</span></code></pre></div>
<p>Nun wird dieser Test standardm√§√üig 3 Mal ausgef√ºhrt, wobei jedes Mal die letzten 3 Argumente von <code>test_floor</code> den entsprechenden Argumenten in der Parameterliste zugeordnet werden.
die entsprechenden Argumente in der Parameterliste.</p>
<p>Sie k√∂nnen auch nur die Parameter <code>negativ</code> und <code>ganzzahlig</code> mit ausf√ºhren:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>pytest<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;negative and integer&quot;</span><span class="w"> </span>tests/test_mytest.py
</span></code></pre></div>
<p>oder alle Untertests au√üer <code>negativ</code>, mit:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>pytest<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;not negative&quot;</span><span class="w"> </span>tests/test_mytest.py
</span></code></pre></div>
<p>Neben der Verwendung des gerade erw√§hnten Filters <code>-k</code> k√∂nnen Sie auch den genauen Namen jedes Untertests herausfinden und jeden
oder alle unter Verwendung ihrer genauen Namen ausf√ºhren.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>pytest<span class="w"> </span>test_this1.py<span class="w"> </span>--collect-only<span class="w"> </span>-q
</span></code></pre></div>
<p>und es wird aufgelistet:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>test_this1.py::TestMathUnitTest::test_floor_0_negative
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>test_this1.py::TestMathUnitTest::test_floor_1_integer
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>test_this1.py::TestMathUnitTest::test_floor_2_large_fraction
</span></code></pre></div>
<p>Jetzt k√∂nnen Sie also nur 2 spezifische Untertests durchf√ºhren:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>pytest<span class="w"> </span>test_this1.py::TestMathUnitTest::test_floor_0_negative<span class="w">  </span>test_this1.py::TestMathUnitTest::test_floor_1_integer
</span></code></pre></div>
<p>Das Modul <a href="https://pypi.org/project/parameterized/">parametrisiert</a>, das sich bereits in den Entwickler-Abh√§ngigkeiten befindet
von <code>transformers</code> befindet, funktioniert sowohl f√ºr <code>unittests</code> als auch f√ºr <code>pytest</code> Tests.</p>
<p>Wenn es sich bei dem Test jedoch nicht um einen <code>Unittest</code> handelt, k√∂nnen Sie <code>pytest.mark.parametrize</code> verwenden (oder Sie k√∂nnen sehen, dass es in
einigen bestehenden Tests verwendet wird, meist unter <code>Beispiele</code>).</p>
<p>Hier ist das gleiche Beispiel, diesmal unter Verwendung der <code>parametrize</code>-Markierung von <code>pytest</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="c1"># test_this2.py</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a>    <span class="s2">&quot;name, input, expected&quot;</span><span class="p">,</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a>    <span class="p">[</span>
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a>        <span class="p">(</span><span class="s2">&quot;negative&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">),</span>
</span><span id="__span-55-9"><a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a>        <span class="p">(</span><span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
</span><span id="__span-55-10"><a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a>        <span class="p">(</span><span class="s2">&quot;large fraction&quot;</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-55-11"><a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a>    <span class="p">],</span>
</span><span id="__span-55-12"><a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a><span class="p">)</span>
</span><span id="__span-55-13"><a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_floor</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
</span><span id="__span-55-14"><a id="__codelineno-55-14" name="__codelineno-55-14" href="#__codelineno-55-14"></a>    <span class="n">assert_equal</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">input</span><span class="p">),</span> <span class="n">expected</span><span class="p">)</span>
</span></code></pre></div>
<p>Genau wie bei <code>parametrisiert</code> k√∂nnen Sie mit <code>pytest.mark.parametrize</code> genau steuern, welche Subtests ausgef√ºhrt werden
ausgef√ºhrt werden, wenn der Filter <code>-k</code> nicht ausreicht. Allerdings erzeugt diese Parametrisierungsfunktion einen etwas anderen Satz von
Namen f√ºr die Untertests. Sie sehen folgenderma√üen aus:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>pytest<span class="w"> </span>test_this2.py<span class="w"> </span>--collect-only<span class="w"> </span>-q
</span></code></pre></div>
<p>und es wird aufgelistet:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>test_this2.py::test_floor<span class="o">[</span>integer-1-1.0<span class="o">]</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>test_this2.py::test_floor<span class="o">[</span>negative--1.5--2.0<span class="o">]</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>test_this2.py::test_floor<span class="o">[</span>large<span class="w"> </span>fraction-1.6-1<span class="o">]</span>
</span></code></pre></div>
<p>Jetzt k√∂nnen Sie also nur den spezifischen Test durchf√ºhren:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>pytest<span class="w"> </span>test_this2.py::test_floor<span class="o">[</span>negative--1.5--2.0<span class="o">]</span><span class="w"> </span>test_this2.py::test_floor<span class="o">[</span>integer-1-1.0<span class="o">]</span>
</span></code></pre></div>
<p>wie im vorherigen Beispiel.</p>
<h3 id="dateien-und-verzeichnisse">Dateien und Verzeichnisse</h3>
<p>In Tests m√ºssen wir oft wissen, wo sich Dinge relativ zur aktuellen Testdatei befinden, und das ist nicht trivial, da der Test
von mehreren Verzeichnissen aus aufgerufen werden kann oder sich in Unterverzeichnissen mit unterschiedlicher Tiefe befinden kann. Eine Hilfsklasse
<code>transformers.test_utils.TestCasePlus</code> l√∂st dieses Problem, indem sie alle grundlegenden Pfade sortiert und einfache
Zugriffsm√∂glichkeiten auf sie bietet:</p>
<ul>
<li>
<p><code>pathlib</code>-Objekte (alle vollst√§ndig aufgel√∂st):</p>
</li>
<li>
<p><code>test_file_path</code> - der aktuelle Testdateipfad, d.h. <code>__file__</code></p>
</li>
<li><code>test_file_dir</code> - das Verzeichnis, das die aktuelle Testdatei enth√§lt</li>
<li><code>tests_dir</code> - das Verzeichnis der <code>tests</code> Testreihe</li>
<li><code>examples_dir</code> - das Verzeichnis der <code>examples</code> Test-Suite</li>
<li><code>repo_root_dir</code> - das Verzeichnis des Repositorys</li>
<li>
<p><code>src_dir</code> - das Verzeichnis von <code>src</code> (d.h. wo sich das Unterverzeichnis <code>transformers</code> befindet)</p>
</li>
<li>
<p>stringifizierte Pfade - wie oben, aber diese geben Pfade als Strings zur√ºck, anstatt als <code>pathlib</code>-Objekte:</p>
</li>
<li>
<p><code>test_file_path_str</code></p>
</li>
<li><code>test_file_dir_str</code></li>
<li><code>tests_dir_str</code></li>
<li><code>examples_dir_str</code></li>
<li><code>repo_root_dir_str</code></li>
<li><code>src_dir_str</code></li>
</ul>
<p>Um diese zu verwenden, m√ºssen Sie lediglich sicherstellen, dass der Test in einer Unterklasse von
<code>transformers.test_utils.TestCasePlus</code> befindet. Zum Beispiel:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">transformers.testing_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestCasePlus</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a>
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">PathExampleTest</span><span class="p">(</span><span class="n">TestCasePlus</span><span class="p">):</span>
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_something_involving_local_locations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a>        <span class="n">data_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tests_dir</span> <span class="o">/</span> <span class="s2">&quot;fixtures/tests_samples/wmt_en_ro&quot;</span>
</span></code></pre></div>
<p>Wenn Sie Pfade nicht √ºber <code>pathlib</code> manipulieren m√ºssen oder nur einen Pfad als String ben√∂tigen, k√∂nnen Sie jederzeit
<code>str()</code> auf das <code>pathlib</code>-Objekt anwenden oder die Accessoren mit der Endung <code>_str</code> verwenden. Zum Beispiel:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">transformers.testing_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestCasePlus</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">PathExampleTest</span><span class="p">(</span><span class="n">TestCasePlus</span><span class="p">):</span>
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_something_involving_stringified_locations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a>        <span class="n">examples_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">examples_dir_str</span>
</span></code></pre></div>
<h3 id="temporare-dateien-und-verzeichnisse">Tempor√§re Dateien und Verzeichnisse</h3>
<p>Die Verwendung eindeutiger tempor√§rer Dateien und Verzeichnisse ist f√ºr die parallele Durchf√ºhrung von Tests unerl√§sslich, damit sich die Tests nicht gegenseitig √ºberschreiben.
Daten gegenseitig √ºberschreiben. Au√üerdem m√∂chten wir, dass die tempor√§ren Dateien und Verzeichnisse am Ende jedes Tests, der sie erstellt hat, gel√∂scht werden.
erstellt hat. Daher ist die Verwendung von Paketen wie <code>tempfile</code>, die diese Anforderungen erf√ºllen, unerl√§sslich.</p>
<p>Beim Debuggen von Tests m√ºssen Sie jedoch sehen k√∂nnen, was in der tempor√§ren Datei oder dem tempor√§ren Verzeichnis gespeichert wird und Sie m√∂chten
Sie m√ºssen den genauen Pfad kennen und d√ºrfen ihn nicht bei jedem neuen Testdurchlauf zuf√§llig √§ndern.</p>
<p>F√ºr solche Zwecke ist die Hilfsklasse <code>transformers.test_utils.TestCasePlus</code> am besten geeignet. Sie ist eine Unterklasse von
Unittest.TestCase`, so dass wir in den Testmodulen einfach von ihr erben k√∂nnen.</p>
<p>Hier ist ein Beispiel f√ºr die Verwendung dieser Klasse:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">transformers.testing_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestCasePlus</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a>
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">ExamplesTests</span><span class="p">(</span><span class="n">TestCasePlus</span><span class="p">):</span>
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_whatever</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-61-6"><a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a>        <span class="n">tmp_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_auto_remove_tmp_dir</span><span class="p">()</span>
</span></code></pre></div>
<p>Dieser Code erstellt ein eindeutiges tempor√§res Verzeichnis und setzt <code>tmp_dir</code> auf dessen Speicherort.</p>
<ul>
<li>Erstellen Sie ein eindeutiges tempor√§res Verzeichnis:</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_whatever</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a>    <span class="n">tmp_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_auto_remove_tmp_dir</span><span class="p">()</span>
</span></code></pre></div>
<p>tmp_dir" enth√§lt den Pfad zu dem erstellten tempor√§ren Verzeichnis. Es wird am Ende des Tests automatisch entfernt.
Tests entfernt.</p>
<ul>
<li>Erstellen Sie ein tempor√§res Verzeichnis meiner Wahl, stellen Sie sicher, dass es leer ist, bevor der Test beginnt, und leeren Sie es nach dem Test nicht.</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_whatever</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>    <span class="n">tmp_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_auto_remove_tmp_dir</span><span class="p">(</span><span class="s2">&quot;./xxx&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>Dies ist n√ºtzlich f√ºr die Fehlersuche, wenn Sie ein bestimmtes Verzeichnis √ºberwachen und sicherstellen m√∂chten, dass die vorherigen Tests keine Daten darin hinterlassen haben.
keine Daten dort hinterlassen haben.</p>
<ul>
<li>
<p>Sie k√∂nnen das Standardverhalten au√üer Kraft setzen, indem Sie die Argumente <code>before</code> und <code>after</code> direkt √ºberschreiben, was zu einem der folgenden Verhaltensweisen f√ºhrt
  folgenden Verhaltensweisen:</p>
</li>
<li>
<p><code>before=True</code>: das tempor√§re Verzeichnis wird immer zu Beginn des Tests gel√∂scht.</p>
</li>
<li><code>before=False</code>: wenn das tempor√§re Verzeichnis bereits existiert, bleiben alle vorhandenen Dateien dort erhalten.</li>
<li><code>after=True</code>: das tempor√§re Verzeichnis wird immer am Ende des Tests gel√∂scht.</li>
<li><code>after=False</code>: das tempor√§re Verzeichnis wird am Ende des Tests immer beibehalten.</li>
</ul>
<p><Tip></p>
<p>Um das √Ñquivalent von <code>rm -r</code> sicher ausf√ºhren zu k√∂nnen, sind nur Unterverzeichnisse des Projektarchivs checkout erlaubt, wenn
ein explizites <code>tmp_dir</code> verwendet wird, so dass nicht versehentlich ein <code>/tmp</code> oder ein √§hnlich wichtiger Teil des Dateisystems vernichtet wird.
d.h. geben Sie bitte immer Pfade an, die mit <code>./</code> beginnen.</p>
<p></Tip></p>
<p><Tip></p>
<p>Jeder Test kann mehrere tempor√§re Verzeichnisse registrieren, die alle automatisch entfernt werden, sofern nicht anders gew√ºnscht.
anders.</p>
<p></Tip></p>
<h3 id="temporare-uberschreibung-von-syspath">Tempor√§re √úberschreibung von sys.path</h3>
<p>Wenn Sie <code>sys.path</code> vor√ºbergehend √ºberschreiben m√ºssen, um z.B. von einem anderen Test zu importieren, k√∂nnen Sie den
Kontextmanager <code>ExtendSysPath</code> verwenden. Beispiel:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">transformers.testing_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExtendSysPath</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="n">bindir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="k">with</span> <span class="n">ExtendSysPath</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bindir</span><span class="si">}</span><span class="s2">/..&quot;</span><span class="p">):</span>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">test_trainer</span><span class="w"> </span><span class="kn">import</span> <span class="n">TrainerIntegrationCommon</span>  <span class="c1"># noqa</span>
</span></code></pre></div>
<h3 id="uberspringen-von-tests">√úberspringen von Tests</h3>
<p>Dies ist n√ºtzlich, wenn ein Fehler gefunden und ein neuer Test geschrieben wird, der Fehler aber noch nicht behoben ist. Damit wir ihn
in das Haupt-Repository zu √ºbertragen, m√ºssen wir sicherstellen, dass er bei <code>make test</code> √ºbersprungen wird.</p>
<p>Methoden:</p>
<ul>
<li>
<p>Ein <strong>Skip</strong> bedeutet, dass Sie erwarten, dass Ihr Test nur dann erfolgreich ist, wenn einige Bedingungen erf√ºllt sind, andernfalls sollte pytest den Test √ºberspringen.
  die Ausf√ºhrung des Tests ganz √ºberspringen. √úbliche Beispiele sind das √úberspringen von Tests, die nur unter Windows laufen, auf Nicht-Windows-Plattformen oder das √úberspringen von
  Tests, die von einer externen Ressource abh√§ngen, die im Moment nicht verf√ºgbar ist (z.B. eine Datenbank).</p>
</li>
<li>
<p>Ein <strong>xfail</strong> bedeutet, dass Sie erwarten, dass ein Test aus irgendeinem Grund fehlschl√§gt. Ein g√§ngiges Beispiel ist ein Test f√ºr eine Funktion, die noch nicht
  noch nicht implementiert oder ein noch nicht behobener Fehler. Wenn ein Test trotz eines erwarteten Fehlschlags bestanden wird (markiert mit
  pytest.mark.xfail), ist dies ein xpass und wird in der Testzusammenfassung gemeldet.</p>
</li>
</ul>
<p>Einer der wichtigsten Unterschiede zwischen den beiden ist, dass <code>skip</code> den Test nicht ausf√ºhrt, w√§hrend <code>xfail</code> dies tut. Wenn also der
Code, der fehlerhaft ist, einen schlechten Zustand verursacht, der sich auf andere Tests auswirkt, sollten Sie also nicht <code>xfail</code> verwenden.</p>
<h4 id="implementierung">Implementierung</h4>
<ul>
<li>Hier sehen Sie, wie Sie einen ganzen Test bedingungslos √ºberspringen k√∂nnen:</li>
</ul>
<p>```python no-style
@unittest.skip(reason="this bug needs to be fixed")
def test_feature_x():
<div class="language-bash highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>oder<span class="w"> </span>mit<span class="w"> </span>pytest:
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="sb">```</span>python<span class="w"> </span>no-style
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a>@pytest.mark.skip<span class="o">(</span><span class="nv">reason</span><span class="o">=</span><span class="s2">&quot;this bug needs to be fixed&quot;</span><span class="o">)</span>
</span></code></pre></div></p>
<p>oder mit dem <code>xfail</code> Weg:</p>
<p>```python no-style
@pytest.mark.xfail
def test_feature_x():
<div class="language-bash highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>-<span class="w"> </span>Hier<span class="w"> </span>erfahren<span class="w"> </span>Sie,<span class="w"> </span>wie<span class="w"> </span>Sie<span class="w"> </span>einen<span class="w"> </span>Test<span class="w"> </span>aufgrund<span class="w"> </span>einer<span class="w"> </span>internen<span class="w"> </span>Pr√ºfung<span class="w"> </span>innerhalb<span class="w"> </span>des<span class="w"> </span>Tests<span class="w"> </span>auslassen<span class="w"> </span>k√∂nnen:
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="sb">```</span>python
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a>def<span class="w"> </span>test_feature_x<span class="o">()</span>:
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>not<span class="w"> </span>has_something<span class="o">()</span>:
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="w">        </span>pytest.skip<span class="o">(</span><span class="s2">&quot;unsupported configuration&quot;</span><span class="o">)</span>
</span></code></pre></div></p>
<p>oder das ganze Modul:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">pytest</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getoption</span><span class="p">(</span><span class="s2">&quot;--custom-flag&quot;</span><span class="p">):</span>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a>    <span class="n">pytest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;--custom-flag is missing, skipping tests&quot;</span><span class="p">,</span> <span class="n">allow_module_level</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div>
<p>oder mit dem <code>xfail</code> Weg:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_feature_x</span><span class="p">():</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a>    <span class="n">pytest</span><span class="o">.</span><span class="n">xfail</span><span class="p">(</span><span class="s2">&quot;expected to fail until bug XYZ is fixed&quot;</span><span class="p">)</span>
</span></code></pre></div>
<ul>
<li>Hier erfahren Sie, wie Sie alle Tests in einem Modul √ºberspringen k√∂nnen, wenn ein Import fehlt:</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="n">docutils</span> <span class="o">=</span> <span class="n">pytest</span><span class="o">.</span><span class="n">importorskip</span><span class="p">(</span><span class="s2">&quot;docutils&quot;</span><span class="p">,</span> <span class="n">minversion</span><span class="o">=</span><span class="s2">&quot;0.3&quot;</span><span class="p">)</span>
</span></code></pre></div>
<ul>
<li>Einen Test aufgrund einer Bedingung √ºberspringen:</li>
</ul>
<p>```python no-style
@pytest.mark.skipif(sys.version_info &lt; (3,6), reason="requires python3.6 or higher")
def test_feature_x():
<div class="language-bash highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>oder:
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="sb">```</span>python<span class="w"> </span>no-style
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a>@unittest.skipIf<span class="o">(</span><span class="nv">torch_device</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;cpu&quot;</span>,<span class="w"> </span><span class="s2">&quot;Can&#39;t do half precision&quot;</span><span class="o">)</span>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a>def<span class="w"> </span>test_feature_x<span class="o">()</span>:
</span></code></pre></div></p>
<p>oder √ºberspringen Sie das ganze Modul:</p>
<p>```python no-style
@pytest.mark.skipif(sys.platform == 'win32', reason="does not run on windows")
class TestClass():
    def test_feature_x(self):
<div class="language-bash highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>Weitere<span class="w"> </span>Details,<span class="w"> </span>Beispiele<span class="w"> </span>und<span class="w"> </span>M√∂glichkeiten<span class="w"> </span>finden<span class="w"> </span>Sie<span class="w"> </span><span class="o">[</span>hier<span class="o">](</span>https://docs.pytest.org/en/latest/skipping.html<span class="o">)</span>.
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="c1">### Langsame Tests</span>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a>
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a>Die<span class="w"> </span>Bibliothek<span class="w"> </span>der<span class="w"> </span>Tests<span class="w"> </span>w√§chst<span class="w"> </span>st√§ndig,<span class="w"> </span>und<span class="w"> </span>einige<span class="w"> </span>der<span class="w"> </span>Tests<span class="w"> </span>brauchen<span class="w"> </span>Minuten,<span class="w"> </span>um<span class="w"> </span>ausgef√ºhrt<span class="w"> </span>zu<span class="w"> </span>werden,<span class="w"> </span>daher<span class="w"> </span>k√∂nnen<span class="w"> </span>wir<span class="w"> </span>es<span class="w"> </span>uns<span class="w"> </span>nicht<span class="w"> </span>leisten,<span class="w"> </span>eine<span class="w"> </span>Stunde<span class="w"> </span>zu<span class="w"> </span>warten,<span class="w"> </span>bis<span class="w"> </span>die
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a>eine<span class="w"> </span>Stunde<span class="w"> </span>auf<span class="w"> </span>die<span class="w"> </span>Fertigstellung<span class="w"> </span>der<span class="w"> </span>Testsuite<span class="w"> </span>auf<span class="w"> </span>CI<span class="w"> </span>zu<span class="w"> </span>warten.<span class="w"> </span>Daher<span class="w"> </span>sollten<span class="w"> </span>langsame<span class="w"> </span>Tests,<span class="w"> </span>mit<span class="w"> </span>einigen<span class="w"> </span>Ausnahmen<span class="w"> </span>f√ºr<span class="w"> </span>wichtige<span class="w"> </span>Tests,<span class="w"> </span>wie<span class="w"> </span>im<span class="w"> </span>folgenden<span class="w"> </span>Beispiel
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a>wie<span class="w"> </span>im<span class="w"> </span>folgenden<span class="w"> </span>Beispiel<span class="w"> </span>markiert<span class="w"> </span>werden:
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a>
</span><span id="__span-71-9"><a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a><span class="sb">```</span>python<span class="w"> </span>no-style
</span><span id="__span-71-10"><a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a>from<span class="w"> </span>transformers.testing_utils<span class="w"> </span>import<span class="w"> </span>slow
</span><span id="__span-71-11"><a id="__codelineno-71-11" name="__codelineno-71-11" href="#__codelineno-71-11"></a>@slow
</span><span id="__span-71-12"><a id="__codelineno-71-12" name="__codelineno-71-12" href="#__codelineno-71-12"></a>def<span class="w"> </span>test_integration_foo<span class="o">()</span>:
</span></code></pre></div></p>
<p>Sobald ein Test als <code>@slow</code> markiert ist, setzen Sie die Umgebungsvariable <code>RUN_SLOW=1</code>, um solche Tests auszuf√ºhren, z.B:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="nv">RUN_SLOW</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>pytest<span class="w"> </span>tests
</span></code></pre></div>
<p>Einige Dekoratoren wie <code>@parameterized</code> schreiben Testnamen um, daher m√ºssen <code>@slow</code> und die √ºbrigen Skip-Dekoratoren
<code>@require_*</code> m√ºssen als letztes aufgef√ºhrt werden, damit sie korrekt funktionieren. Hier ist ein Beispiel f√ºr die korrekte Verwendung:</p>
<p>```python no-style
@parameterized.expand(...)
@slow
def test_integration_foo():
<div class="language-bash highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a>Wie<span class="w"> </span>zu<span class="w"> </span>Beginn<span class="w"> </span>dieses<span class="w"> </span>Dokuments<span class="w"> </span>erl√§utert,<span class="w"> </span>werden<span class="w"> </span>langsame<span class="w"> </span>Tests<span class="w"> </span>nach<span class="w"> </span>einem<span class="w"> </span>Zeitplan<span class="w"> </span>ausgef√ºhrt<span class="w"> </span>und<span class="w"> </span>nicht<span class="w"> </span><span class="k">in</span><span class="w"> </span>PRs<span class="w"> </span>CI
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a>Pr√ºfungen.<span class="w"> </span>Es<span class="w"> </span>ist<span class="w"> </span>also<span class="w"> </span>m√∂glich,<span class="w"> </span>dass<span class="w"> </span>einige<span class="w"> </span>Probleme<span class="w"> </span>bei<span class="w"> </span>der<span class="w"> </span>Einreichung<span class="w"> </span>eines<span class="w"> </span>PRs<span class="w"> </span>√ºbersehen<span class="w"> </span>werden<span class="w"> </span>und<span class="w"> </span>zusammengef√ºhrt<span class="w"> </span>werden.<span class="w"> </span>Solche<span class="w"> </span>Probleme<span class="w"> </span>werden
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a>werden<span class="w"> </span>beim<span class="w"> </span>n√§chsten<span class="w"> </span>geplanten<span class="w"> </span>CI-Job<span class="w"> </span>abgefangen.<span class="w"> </span>Das<span class="w"> </span>bedeutet<span class="w"> </span>aber<span class="w"> </span>auch,<span class="w"> </span>dass<span class="w"> </span>es<span class="w"> </span>wichtig<span class="w"> </span>ist,<span class="w"> </span>die<span class="w"> </span>langsamen<span class="w"> </span>Tests<span class="w"> </span>auf<span class="w"> </span>Ihrem
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a>Rechner<span class="w"> </span>auszuf√ºhren,<span class="w"> </span>bevor<span class="w"> </span>Sie<span class="w"> </span>den<span class="w"> </span>PR<span class="w"> </span>einreichen.
</span><span id="__span-73-5"><a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a>
</span><span id="__span-73-6"><a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a>Hier<span class="w"> </span>ist<span class="w"> </span>ein<span class="w"> </span>grober<span class="w"> </span>Entscheidungsmechanismus<span class="w"> </span>f√ºr<span class="w"> </span>die<span class="w"> </span>Auswahl<span class="w"> </span>der<span class="w"> </span>Tests,<span class="w"> </span>die<span class="w"> </span>als<span class="w"> </span>langsam<span class="w"> </span>markiert<span class="w"> </span>werden<span class="w"> </span>sollen:
</span><span id="__span-73-7"><a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a>
</span><span id="__span-73-8"><a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a>Wenn<span class="w"> </span>der<span class="w"> </span>Test<span class="w"> </span>auf<span class="w"> </span>eine<span class="w"> </span>der<span class="w"> </span>internen<span class="w"> </span>Komponenten<span class="w"> </span>der<span class="w"> </span>Bibliothek<span class="w"> </span>ausgerichtet<span class="w"> </span>ist<span class="w"> </span><span class="o">(</span>z.B.<span class="w"> </span>Modellierungsdateien,<span class="w"> </span>Tokenisierungsdateien,
</span><span id="__span-73-9"><a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a>Pipelines<span class="o">)</span>,<span class="w"> </span>dann<span class="w"> </span>sollten<span class="w"> </span>wir<span class="w"> </span>diesen<span class="w"> </span>Test<span class="w"> </span><span class="k">in</span><span class="w"> </span>der<span class="w"> </span>nicht<span class="w"> </span>langsamen<span class="w"> </span>Testsuite<span class="w"> </span>ausf√ºhren.<span class="w"> </span>Wenn<span class="w"> </span>er<span class="w"> </span>sich<span class="w"> </span>auf<span class="w"> </span>einen<span class="w"> </span>anderen<span class="w"> </span>Aspekt<span class="w"> </span>der<span class="w"> </span>Bibliothek<span class="w"> </span>bezieht,
</span><span id="__span-73-10"><a id="__codelineno-73-10" name="__codelineno-73-10" href="#__codelineno-73-10"></a>wie<span class="w"> </span>z.B.<span class="w"> </span>die<span class="w"> </span>Dokumentation<span class="w"> </span>oder<span class="w"> </span>die<span class="w"> </span>Beispiele,<span class="w"> </span>dann<span class="w"> </span>sollten<span class="w"> </span>wir<span class="w"> </span>diese<span class="w"> </span>Tests<span class="w"> </span><span class="k">in</span><span class="w"> </span>der<span class="w"> </span>langsamen<span class="w"> </span>Testsuite<span class="w"> </span>durchf√ºhren.<span class="w"> </span>Und<span class="w"> </span>dann,<span class="w"> </span>zur<span class="w"> </span>Verfeinerung
</span><span id="__span-73-11"><a id="__codelineno-73-11" name="__codelineno-73-11" href="#__codelineno-73-11"></a>Ansatz<span class="w"> </span>zu<span class="w"> </span>verfeinern,<span class="w"> </span>sollten<span class="w"> </span>wir<span class="w"> </span>Ausnahmen<span class="w"> </span>einf√ºhren:
</span><span id="__span-73-12"><a id="__codelineno-73-12" name="__codelineno-73-12" href="#__codelineno-73-12"></a>
</span><span id="__span-73-13"><a id="__codelineno-73-13" name="__codelineno-73-13" href="#__codelineno-73-13"></a>-<span class="w"> </span>Alle<span class="w"> </span>Tests,<span class="w"> </span>die<span class="w"> </span>einen<span class="w"> </span>umfangreichen<span class="w"> </span>Satz<span class="w"> </span>von<span class="w"> </span>Gewichten<span class="w"> </span>oder<span class="w"> </span>einen<span class="w"> </span>Datensatz<span class="w"> </span>mit<span class="w"> </span>einer<span class="w"> </span>Gr√∂√üe<span class="w"> </span>von<span class="w"> </span>mehr<span class="w"> </span>als<span class="w"> </span>~50MB<span class="w"> </span>herunterladen<span class="w"> </span>m√ºssen<span class="w"> </span><span class="o">(</span>z.B.<span class="w"> </span>Modell-<span class="w"> </span>oder
</span><span id="__span-73-14"><a id="__codelineno-73-14" name="__codelineno-73-14" href="#__codelineno-73-14"></a><span class="w">  </span>Tokenizer-Integrationstests,<span class="w"> </span>Pipeline-Integrationstests<span class="o">)</span><span class="w"> </span>sollten<span class="w"> </span>auf<span class="w"> </span>langsam<span class="w"> </span>gesetzt<span class="w"> </span>werden.<span class="w"> </span>Wenn<span class="w"> </span>Sie<span class="w"> </span>ein<span class="w"> </span>neues<span class="w"> </span>Modell<span class="w"> </span>hinzuf√ºgen,<span class="w"> </span>sollten<span class="w"> </span>Sie
</span><span id="__span-73-15"><a id="__codelineno-73-15" name="__codelineno-73-15" href="#__codelineno-73-15"></a><span class="w">  </span>sollten<span class="w"> </span>Sie<span class="w"> </span>eine<span class="w"> </span>kleine<span class="w"> </span>Version<span class="w"> </span>des<span class="w"> </span>Modells<span class="w"> </span><span class="o">(</span>mit<span class="w"> </span>zuf√§lligen<span class="w"> </span>Gewichtungen<span class="o">)</span><span class="w"> </span>f√ºr<span class="w"> </span>Integrationstests<span class="w"> </span>erstellen<span class="w"> </span>und<span class="w"> </span><span class="k">in</span><span class="w"> </span>den<span class="w"> </span>Hub<span class="w"> </span>hochladen.<span class="w"> </span>Dies<span class="w"> </span>wird
</span><span id="__span-73-16"><a id="__codelineno-73-16" name="__codelineno-73-16" href="#__codelineno-73-16"></a><span class="w">  </span>wird<span class="w"> </span><span class="k">in</span><span class="w"> </span>den<span class="w"> </span>folgenden<span class="w"> </span>Abschnitten<span class="w"> </span>erl√§utert.
</span><span id="__span-73-17"><a id="__codelineno-73-17" name="__codelineno-73-17" href="#__codelineno-73-17"></a>-<span class="w"> </span>Alle<span class="w"> </span>Tests,<span class="w"> </span>die<span class="w"> </span>ein<span class="w"> </span>Training<span class="w"> </span>durchf√ºhren<span class="w"> </span>m√ºssen,<span class="w"> </span>das<span class="w"> </span>nicht<span class="w"> </span>speziell<span class="w"> </span>auf<span class="w"> </span>Schnelligkeit<span class="w"> </span>optimiert<span class="w"> </span>ist,<span class="w"> </span>sollten<span class="w"> </span>auf<span class="w"> </span>langsam<span class="w"> </span>gesetzt<span class="w"> </span>werden.
</span><span id="__span-73-18"><a id="__codelineno-73-18" name="__codelineno-73-18" href="#__codelineno-73-18"></a>-<span class="w"> </span>Wir<span class="w"> </span>k√∂nnen<span class="w"> </span>Ausnahmen<span class="w"> </span>einf√ºhren,<span class="w"> </span>wenn<span class="w"> </span>einige<span class="w"> </span>dieser<span class="w"> </span>Tests,<span class="w"> </span>die<span class="w"> </span>nicht<span class="w"> </span>langsam<span class="w"> </span>sein<span class="w"> </span>sollten,<span class="w"> </span>unertr√§glich<span class="w"> </span>langsam<span class="w"> </span>sind,<span class="w"> </span>und<span class="w"> </span>sie<span class="w"> </span>auf
</span><span id="__span-73-19"><a id="__codelineno-73-19" name="__codelineno-73-19" href="#__codelineno-73-19"></a><span class="w">  </span><span class="sb">`</span>@slow<span class="sb">`</span>.<span class="w"> </span>Auto-Modellierungstests,<span class="w"> </span>die<span class="w"> </span>gro√üe<span class="w"> </span>Dateien<span class="w"> </span>auf<span class="w"> </span>der<span class="w"> </span>Festplatte<span class="w"> </span>speichern<span class="w"> </span>und<span class="w"> </span>laden,<span class="w"> </span>sind<span class="w"> </span>ein<span class="w"> </span>gutes<span class="w"> </span>Beispiel<span class="w"> </span>f√ºr<span class="w"> </span>Tests,<span class="w"> </span>die<span class="w"> </span>als
</span><span id="__span-73-20"><a id="__codelineno-73-20" name="__codelineno-73-20" href="#__codelineno-73-20"></a><span class="w">  </span>als<span class="w"> </span><span class="sb">`</span>@slow<span class="sb">`</span><span class="w"> </span>markiert<span class="w"> </span>sind.
</span><span id="__span-73-21"><a id="__codelineno-73-21" name="__codelineno-73-21" href="#__codelineno-73-21"></a>-<span class="w"> </span>Wenn<span class="w"> </span>ein<span class="w"> </span>Test<span class="w"> </span><span class="k">in</span><span class="w"> </span>weniger<span class="w"> </span>als<span class="w"> </span><span class="m">1</span><span class="w"> </span>Sekunde<span class="w"> </span>auf<span class="w"> </span>CI<span class="w"> </span>abgeschlossen<span class="w"> </span>wird<span class="w"> </span><span class="o">(</span>einschlie√ülich<span class="w"> </span>eventueller<span class="w"> </span>Downloads<span class="o">)</span>,<span class="w"> </span>sollte<span class="w"> </span>es<span class="w"> </span>sich<span class="w"> </span>trotzdem<span class="w"> </span>um<span class="w"> </span>einen<span class="w"> </span>normalen<span class="w"> </span>Test<span class="w"> </span>handeln.
</span><span id="__span-73-22"><a id="__codelineno-73-22" name="__codelineno-73-22" href="#__codelineno-73-22"></a>
</span><span id="__span-73-23"><a id="__codelineno-73-23" name="__codelineno-73-23" href="#__codelineno-73-23"></a>Insgesamt<span class="w"> </span>m√ºssen<span class="w"> </span>alle<span class="w"> </span>nicht<span class="w"> </span>langsamen<span class="w"> </span>Tests<span class="w"> </span>die<span class="w"> </span>verschiedenen<span class="w"> </span>Interna<span class="w"> </span>abdecken<span class="w"> </span>und<span class="w"> </span>dabei<span class="w"> </span>schnell<span class="w"> </span>bleiben.<span class="w"> </span>Zum<span class="w"> </span>Beispiel,
</span><span id="__span-73-24"><a id="__codelineno-73-24" name="__codelineno-73-24" href="#__codelineno-73-24"></a>kann<span class="w"> </span>eine<span class="w"> </span>signifikante<span class="w"> </span>Abdeckung<span class="w"> </span>erreicht<span class="w"> </span>werden,<span class="w"> </span>indem<span class="w"> </span>Sie<span class="w"> </span>mit<span class="w"> </span>speziell<span class="w"> </span>erstellten<span class="w"> </span>kleinen<span class="w"> </span>Modellen<span class="w"> </span>mit<span class="w"> </span>zuf√§lligen<span class="w"> </span>Gewichten<span class="w"> </span>testen.<span class="w"> </span>Solche<span class="w"> </span>Modelle
</span><span id="__span-73-25"><a id="__codelineno-73-25" name="__codelineno-73-25" href="#__codelineno-73-25"></a>haben<span class="w"> </span>eine<span class="w"> </span>sehr<span class="w"> </span>geringe<span class="w"> </span>Anzahl<span class="w"> </span>von<span class="w"> </span>Schichten<span class="w"> </span><span class="o">(</span>z.B.<span class="w"> </span><span class="m">2</span><span class="o">)</span>,<span class="w"> </span>Vokabeln<span class="w"> </span><span class="o">(</span>z.B.<span class="w"> </span><span class="m">1000</span><span class="o">)</span>,<span class="w"> </span>usw.<span class="w"> </span>Dann<span class="w"> </span>k√∂nnen<span class="w"> </span>die<span class="w"> </span><span class="sb">`</span>@slow<span class="sb">`</span>-Tests<span class="w"> </span>gro√üe
</span><span id="__span-73-26"><a id="__codelineno-73-26" name="__codelineno-73-26" href="#__codelineno-73-26"></a>langsame<span class="w"> </span>Modelle<span class="w"> </span>verwenden,<span class="w"> </span>um<span class="w"> </span>qualitative<span class="w"> </span>Tests<span class="w"> </span>durchzuf√ºhren.<span class="w"> </span>Um<span class="w"> </span>die<span class="w"> </span>Verwendung<span class="w"> </span>dieser<span class="w"> </span>Modelle<span class="w"> </span>zu<span class="w"> </span>sehen,<span class="w"> </span>suchen<span class="w"> </span>Sie<span class="w"> </span>einfach<span class="w"> </span>nach<span class="w"> </span>*winzigen*<span class="w"> </span>Modellen<span class="w"> </span>mit:
</span><span id="__span-73-27"><a id="__codelineno-73-27" name="__codelineno-73-27" href="#__codelineno-73-27"></a>
</span><span id="__span-73-28"><a id="__codelineno-73-28" name="__codelineno-73-28" href="#__codelineno-73-28"></a><span class="sb">```</span>bash
</span><span id="__span-73-29"><a id="__codelineno-73-29" name="__codelineno-73-29" href="#__codelineno-73-29"></a>grep<span class="w"> </span>tiny<span class="w"> </span>tests<span class="w"> </span>examples
</span></code></pre></div></p>
<p>Hier ist ein Beispiel f√ºr ein <a href="https://github.com/huggingface/transformers/tree/main/scripts/fsmt/fsmt-make-tiny-model.py">Skript</a>, das das winzige Modell erstellt hat
<a href="https://huggingface.co/stas/tiny-wmt19-en-de">stas/tiny-wmt19-en-de</a>. Sie k√∂nnen es ganz einfach an Ihre eigene
Architektur Ihres Modells anpassen.</p>
<p>Es ist leicht, die Laufzeit falsch zu messen, wenn zum Beispiel ein gro√ües Modell heruntergeladen wird, aber wenn
Sie es lokal testen, w√ºrden die heruntergeladenen Dateien zwischengespeichert und somit die Download-Zeit nicht gemessen werden. Pr√ºfen Sie daher den
Ausf√ºhrungsgeschwindigkeitsbericht in den CI-Protokollen (die Ausgabe von <code>pytest --durations=0 tests</code>).</p>
<p>Dieser Bericht ist auch n√ºtzlich, um langsame Ausrei√üer zu finden, die nicht als solche gekennzeichnet sind oder die neu geschrieben werden m√ºssen, um schnell zu sein.
Wenn Sie bemerken, dass die Testsuite beim CI langsam wird, zeigt die oberste Liste dieses Berichts die langsamsten
Tests.</p>
<h3 id="testen-der-stdoutstderr-ausgabe">Testen der stdout/stderr-Ausgabe</h3>
<p>Um Funktionen zu testen, die in <code>stdout</code> und/oder <code>stderr</code> schreiben, kann der Test auf diese Str√∂me zugreifen, indem er die
<a href="https://docs.pytest.org/en/latest/capture.html">capsys system</a> von <code>pytest</code> zugreifen. So wird dies bewerkstelligt:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a>
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">print_to_stdout</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="__span-74-6"><a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a>
</span><span id="__span-74-7"><a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a>
</span><span id="__span-74-8"><a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">print_to_stderr</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="__span-74-9"><a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="__span-74-10"><a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a>
</span><span id="__span-74-11"><a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a>
</span><span id="__span-74-12"><a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_result_and_stdout</span><span class="p">(</span><span class="n">capsys</span><span class="p">):</span>
</span><span id="__span-74-13"><a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a>    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Hello&quot;</span>
</span><span id="__span-74-14"><a id="__codelineno-74-14" name="__codelineno-74-14" href="#__codelineno-74-14"></a>    <span class="n">print_to_stdout</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="__span-74-15"><a id="__codelineno-74-15" name="__codelineno-74-15" href="#__codelineno-74-15"></a>    <span class="n">print_to_stderr</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="__span-74-16"><a id="__codelineno-74-16" name="__codelineno-74-16" href="#__codelineno-74-16"></a>    <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">capsys</span><span class="o">.</span><span class="n">readouterr</span><span class="p">()</span>  <span class="c1"># consume the captured output streams</span>
</span><span id="__span-74-17"><a id="__codelineno-74-17" name="__codelineno-74-17" href="#__codelineno-74-17"></a>    <span class="c1"># optional: if you want to replay the consumed streams:</span>
</span><span id="__span-74-18"><a id="__codelineno-74-18" name="__codelineno-74-18" href="#__codelineno-74-18"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</span><span id="__span-74-19"><a id="__codelineno-74-19" name="__codelineno-74-19" href="#__codelineno-74-19"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
</span><span id="__span-74-20"><a id="__codelineno-74-20" name="__codelineno-74-20" href="#__codelineno-74-20"></a>    <span class="c1"># test:</span>
</span><span id="__span-74-21"><a id="__codelineno-74-21" name="__codelineno-74-21" href="#__codelineno-74-21"></a>    <span class="k">assert</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">out</span>
</span><span id="__span-74-22"><a id="__codelineno-74-22" name="__codelineno-74-22" href="#__codelineno-74-22"></a>    <span class="k">assert</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">err</span>
</span></code></pre></div>
<p>Und nat√ºrlich wird <code>stderr</code> in den meisten F√§llen als Teil einer Ausnahme auftreten, so dass try/except in einem solchen Fall verwendet werden muss
Fall verwendet werden:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">raise_exception</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a>
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a>
</span><span id="__span-75-5"><a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_something_exception</span><span class="p">():</span>
</span><span id="__span-75-6"><a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a>    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Not a good value&quot;</span>
</span><span id="__span-75-7"><a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a>    <span class="n">error</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-75-8"><a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-75-9"><a id="__codelineno-75-9" name="__codelineno-75-9" href="#__codelineno-75-9"></a>        <span class="n">raise_exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="__span-75-10"><a id="__codelineno-75-10" name="__codelineno-75-10" href="#__codelineno-75-10"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-75-11"><a id="__codelineno-75-11" name="__codelineno-75-11" href="#__codelineno-75-11"></a>        <span class="n">error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-75-12"><a id="__codelineno-75-12" name="__codelineno-75-12" href="#__codelineno-75-12"></a>        <span class="k">assert</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">error</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2"> is in the exception:</span><span class="se">\n</span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span>
</span></code></pre></div>
<p>Ein anderer Ansatz zur Erfassung von stdout ist <code>contextlib.redirect_stdout</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">StringIO</span>
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">contextlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">redirect_stdout</span>
</span><span id="__span-76-3"><a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>
</span><span id="__span-76-4"><a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a>
</span><span id="__span-76-5"><a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">print_to_stdout</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="__span-76-6"><a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="__span-76-7"><a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a>
</span><span id="__span-76-8"><a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a>
</span><span id="__span-76-9"><a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_result_and_stdout</span><span class="p">():</span>
</span><span id="__span-76-10"><a id="__codelineno-76-10" name="__codelineno-76-10" href="#__codelineno-76-10"></a>    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Hello&quot;</span>
</span><span id="__span-76-11"><a id="__codelineno-76-11" name="__codelineno-76-11" href="#__codelineno-76-11"></a>    <span class="n">buffer</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
</span><span id="__span-76-12"><a id="__codelineno-76-12" name="__codelineno-76-12" href="#__codelineno-76-12"></a>    <span class="k">with</span> <span class="n">redirect_stdout</span><span class="p">(</span><span class="n">buffer</span><span class="p">):</span>
</span><span id="__span-76-13"><a id="__codelineno-76-13" name="__codelineno-76-13" href="#__codelineno-76-13"></a>        <span class="n">print_to_stdout</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="__span-76-14"><a id="__codelineno-76-14" name="__codelineno-76-14" href="#__codelineno-76-14"></a>    <span class="n">out</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</span><span id="__span-76-15"><a id="__codelineno-76-15" name="__codelineno-76-15" href="#__codelineno-76-15"></a>    <span class="c1"># optional: if you want to replay the consumed streams:</span>
</span><span id="__span-76-16"><a id="__codelineno-76-16" name="__codelineno-76-16" href="#__codelineno-76-16"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</span><span id="__span-76-17"><a id="__codelineno-76-17" name="__codelineno-76-17" href="#__codelineno-76-17"></a>    <span class="c1"># test:</span>
</span><span id="__span-76-18"><a id="__codelineno-76-18" name="__codelineno-76-18" href="#__codelineno-76-18"></a>    <span class="k">assert</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">out</span>
</span></code></pre></div>
<p>Ein wichtiges potenzielles Problem beim Erfassen von stdout ist, dass es <code>r</code> Zeichen enthalten kann, die bei normalem <code>print</code>
alles zur√ºcksetzen, was bisher gedruckt wurde. Mit <code>pytest</code> gibt es kein Problem, aber mit <code>pytest -s</code> werden diese
werden diese Zeichen in den Puffer aufgenommen. Um den Test mit und ohne <code>-s</code> laufen zu lassen, m√ºssen Sie also eine zus√§tzliche Bereinigung
zus√§tzliche Bereinigung der erfassten Ausgabe vornehmen, indem Sie <code>re.sub(r'~.*\r', '', buf, 0, re.M)</code> verwenden.</p>
<p>Aber dann haben wir einen Hilfskontextmanager-Wrapper, der sich automatisch um alles k√ºmmert, unabh√§ngig davon, ob er
einige "<em>.</em>.<em>.</em>" enth√§lt oder nicht:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">transformers.testing_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">CaptureStdout</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="k">with</span> <span class="n">CaptureStdout</span><span class="p">()</span> <span class="k">as</span> <span class="n">cs</span><span class="p">:</span>
</span><span id="__span-77-4"><a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a>    <span class="n">function_that_writes_to_stdout</span><span class="p">()</span>
</span><span id="__span-77-5"><a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a><span class="nb">print</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">out</span><span class="p">)</span>
</span></code></pre></div>
<p>Hier ist ein vollst√§ndiges Testbeispiel:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">transformers.testing_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">CaptureStdout</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a>
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Secret message</span><span class="se">\r</span><span class="s2">&quot;</span>
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a><span class="n">final</span> <span class="o">=</span> <span class="s2">&quot;Hello World&quot;</span>
</span><span id="__span-78-5"><a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a><span class="k">with</span> <span class="n">CaptureStdout</span><span class="p">()</span> <span class="k">as</span> <span class="n">cs</span><span class="p">:</span>
</span><span id="__span-78-6"><a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">final</span><span class="p">)</span>
</span><span id="__span-78-7"><a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a><span class="k">assert</span> <span class="n">cs</span><span class="o">.</span><span class="n">out</span> <span class="o">==</span> <span class="n">final</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;captured: </span><span class="si">{</span><span class="n">cs</span><span class="o">.</span><span class="n">out</span><span class="si">}</span><span class="s2">, expecting </span><span class="si">{</span><span class="n">final</span><span class="si">}</span><span class="s2">&quot;</span>
</span></code></pre></div>
<p>Wenn Sie <code>stderr</code> aufzeichnen m√∂chten, verwenden Sie stattdessen die Klasse <code>CaptureStderr</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">transformers.testing_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">CaptureStderr</span>
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a>
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="k">with</span> <span class="n">CaptureStderr</span><span class="p">()</span> <span class="k">as</span> <span class="n">cs</span><span class="p">:</span>
</span><span id="__span-79-4"><a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a>    <span class="n">function_that_writes_to_stderr</span><span class="p">()</span>
</span><span id="__span-79-5"><a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a><span class="nb">print</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">err</span><span class="p">)</span>
</span></code></pre></div>
<p>Wenn Sie beide Streams auf einmal erfassen m√ºssen, verwenden Sie die √ºbergeordnete Klasse <code>CaptureStd</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">transformers.testing_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">CaptureStd</span>
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a>
</span><span id="__span-80-3"><a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a><span class="k">with</span> <span class="n">CaptureStd</span><span class="p">()</span> <span class="k">as</span> <span class="n">cs</span><span class="p">:</span>
</span><span id="__span-80-4"><a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a>    <span class="n">function_that_writes_to_stdout_and_stderr</span><span class="p">()</span>
</span><span id="__span-80-5"><a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a><span class="nb">print</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">err</span><span class="p">,</span> <span class="n">cs</span><span class="o">.</span><span class="n">out</span><span class="p">)</span>
</span></code></pre></div>
<p>Um das Debuggen von Testproblemen zu erleichtern, geben diese Kontextmanager standardm√§√üig die aufgezeichneten Streams beim Verlassen
aus dem Kontext wieder.</p>
<h3 id="erfassen-von-logger-streams">Erfassen von Logger-Streams</h3>
<p>Wenn Sie die Ausgabe eines Loggers validieren m√ºssen, k√∂nnen Sie <code>CaptureLogger</code> verwenden:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">logging</span>
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">transformers.testing_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">CaptureLogger</span>
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a>
</span><span id="__span-81-4"><a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Testing 1, 2, 3&quot;</span>
</span><span id="__span-81-5"><a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a><span class="n">logging</span><span class="o">.</span><span class="n">set_verbosity_info</span><span class="p">()</span>
</span><span id="__span-81-6"><a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="s2">&quot;transformers.models.bart.tokenization_bart&quot;</span><span class="p">)</span>
</span><span id="__span-81-7"><a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a><span class="k">with</span> <span class="n">CaptureLogger</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span> <span class="k">as</span> <span class="n">cl</span><span class="p">:</span>
</span><span id="__span-81-8"><a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="__span-81-9"><a id="__codelineno-81-9" name="__codelineno-81-9" href="#__codelineno-81-9"></a><span class="k">assert</span> <span class="n">cl</span><span class="o">.</span><span class="n">out</span><span class="p">,</span> <span class="n">msg</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span></code></pre></div>
<h3 id="testen-mit-umgebungsvariablen">Testen mit Umgebungsvariablen</h3>
<p>Wenn Sie die Auswirkungen von Umgebungsvariablen f√ºr einen bestimmten Test testen m√∂chten, k√∂nnen Sie einen Hilfsdekorator verwenden
<code>transformers.testing_utils.mockenv</code></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">transformers.testing_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">mockenv</span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a>
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a>
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">HfArgumentParserTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
</span><span id="__span-82-5"><a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a>    <span class="nd">@mockenv</span><span class="p">(</span><span class="n">TRANSFORMERS_VERBOSITY</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
</span><span id="__span-82-6"><a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_env_override</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-82-7"><a id="__codelineno-82-7" name="__codelineno-82-7" href="#__codelineno-82-7"></a>        <span class="n">env_level_str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;TRANSFORMERS_VERBOSITY&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></code></pre></div>
<p>Manchmal muss ein externes Programm aufgerufen werden, was die Einstellung von <code>PYTHONPATH</code> in <code>os.environ</code> erfordert, um mehrere lokale Pfade einzuschlie√üen.
mehrere lokale Pfade. Eine Hilfsklasse <code>transformers.test_utils.TestCasePlus</code> hilft Ihnen dabei:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">transformers.testing_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestCasePlus</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a>
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a>
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">EnvExampleTest</span><span class="p">(</span><span class="n">TestCasePlus</span><span class="p">):</span>
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_external_prog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-83-6"><a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a>        <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_env</span><span class="p">()</span>
</span><span id="__span-83-7"><a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a>        <span class="c1"># now call the external program, passing `env` to it</span>
</span></code></pre></div>
<p>Je nachdem, ob die Testdatei in der Testsuite <code>tests</code> oder in <code>examples</code> war, wird sie korrekt eingerichtet
<code>env[PYTHONPATH]</code> eines dieser beiden Verzeichnisse und auch das <code>src</code> Verzeichnis, um sicherzustellen, dass der Test gegen das aktuelle
um sicherzustellen, dass der Test mit dem aktuellen Projektarchiv durchgef√ºhrt wird, und schlie√ülich mit dem, was in <code>env[PYTHONPATH]</code> bereits eingestellt war, bevor der Test aufgerufen wurde.
wenn √ºberhaupt.</p>
<p>Diese Hilfsmethode erstellt eine Kopie des Objekts <code>os.environ</code>, so dass das Original intakt bleibt.</p>
<h3 id="reproduzierbare-ergebnisse-erhalten">Reproduzierbare Ergebnisse erhalten</h3>
<p>In manchen Situationen m√∂chten Sie vielleicht die Zuf√§lligkeit Ihrer Tests beseitigen. Um identische, reproduzierbare Ergebnisse zu erhalten, m√ºssen Sie
m√ºssen Sie den Seed festlegen:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="n">seed</span> <span class="o">=</span> <span class="mi">42</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a>
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="c1"># python RNG</span>
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-84-5"><a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a>
</span><span id="__span-84-6"><a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</span><span id="__span-84-7"><a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a>
</span><span id="__span-84-8"><a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a><span class="c1"># pytorch RNGs</span>
</span><span id="__span-84-9"><a id="__codelineno-84-9" name="__codelineno-84-9" href="#__codelineno-84-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
</span><span id="__span-84-10"><a id="__codelineno-84-10" name="__codelineno-84-10" href="#__codelineno-84-10"></a>
</span><span id="__span-84-11"><a id="__codelineno-84-11" name="__codelineno-84-11" href="#__codelineno-84-11"></a><span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</span><span id="__span-84-12"><a id="__codelineno-84-12" name="__codelineno-84-12" href="#__codelineno-84-12"></a><span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">deterministic</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-84-13"><a id="__codelineno-84-13" name="__codelineno-84-13" href="#__codelineno-84-13"></a><span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
</span><span id="__span-84-14"><a id="__codelineno-84-14" name="__codelineno-84-14" href="#__codelineno-84-14"></a>    <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">manual_seed_all</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</span><span id="__span-84-15"><a id="__codelineno-84-15" name="__codelineno-84-15" href="#__codelineno-84-15"></a>
</span><span id="__span-84-16"><a id="__codelineno-84-16" name="__codelineno-84-16" href="#__codelineno-84-16"></a><span class="c1"># numpy RNG</span>
</span><span id="__span-84-17"><a id="__codelineno-84-17" name="__codelineno-84-17" href="#__codelineno-84-17"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="__span-84-18"><a id="__codelineno-84-18" name="__codelineno-84-18" href="#__codelineno-84-18"></a>
</span><span id="__span-84-19"><a id="__codelineno-84-19" name="__codelineno-84-19" href="#__codelineno-84-19"></a><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="tests-debuggen">Tests debuggen</h3>
<p>Um einen Debugger an der Stelle zu starten, an der die Warnung auftritt, gehen Sie wie folgt vor:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a>pytest<span class="w"> </span>tests/utils/test_logging.py<span class="w"> </span>-W<span class="w"> </span>error::UserWarning<span class="w"> </span>--pdb
</span></code></pre></div>
<h2 id="arbeiten-mit-github-aktionen-workflows">Arbeiten mit Github-Aktionen-Workflows</h2>
<p>Um einen CI-Job f√ºr einen Self-Push-Workflow auszul√∂sen, m√ºssen Sie:</p>
<ol>
<li>Erstellen Sie einen neuen Zweig auf <code>transformers</code> Ursprung (keine Gabelung!).</li>
<li>Der Name der Verzweigung muss entweder mit <code>ci_</code> oder <code>ci-</code> beginnen (<code>main</code> l√∂st ihn auch aus, aber wir k√∂nnen keine PRs auf
   <code>main</code>). Es wird auch nur f√ºr bestimmte Pfade ausgel√∂st - Sie k√∂nnen die aktuelle Definition finden, falls sie
   falls sie sich seit der Erstellung dieses Dokuments ge√§ndert hat <a href="https://github.com/huggingface/transformers/blob/main/.github/workflows/self-push.yml">hier</a> unter <em>push:</em></li>
<li>Erstellen Sie einen PR von diesem Zweig.</li>
<li>Dann k√∂nnen Sie sehen, wie der Job erscheint <a href="https://github.com/huggingface/transformers/actions/workflows/self-push.yml">hier</a>. Er wird m√∂glicherweise nicht sofort ausgef√ºhrt, wenn es
   ein Backlog vorhanden ist.</li>
</ol>
<h2 id="testen-experimenteller-ci-funktionen">Testen experimenteller CI-Funktionen</h2>
<p>Das Testen von CI-Funktionen kann potenziell problematisch sein, da es die normale CI-Funktion beeintr√§chtigen kann. Wenn also eine
neue CI-Funktion hinzugef√ºgt werden soll, sollte dies wie folgt geschehen.</p>
<ol>
<li>Erstellen Sie einen neuen Auftrag, der die zu testende Funktion testet.</li>
<li>Der neue Job muss immer erfolgreich sein, so dass er uns ein gr√ºnes ‚úì gibt (Details unten).</li>
<li>Lassen Sie ihn einige Tage lang laufen, um zu sehen, dass eine Vielzahl verschiedener PR-Typen darauf laufen (Benutzer-Gabelzweige,
   nicht geforkte Zweige, Zweige, die von github.com UI direct file edit stammen, verschiedene erzwungene Pushes, etc. - es gibt
   es gibt so viele), w√§hrend Sie die Protokolle des experimentellen Jobs √ºberwachen (nicht den gesamten Job gr√ºn, da er absichtlich immer
   gr√ºn)</li>
<li>Wenn klar ist, dass alles in Ordnung ist, f√ºgen Sie die neuen √Ñnderungen in die bestehenden Jobs ein.</li>
</ol>
<p>Auf diese Weise wird der normale Arbeitsablauf nicht durch Experimente mit der CI-Funktionalit√§t selbst beeintr√§chtigt.</p>
<p>Wie k√∂nnen wir nun daf√ºr sorgen, dass der Auftrag immer erfolgreich ist, w√§hrend die neue CI-Funktion entwickelt wird?</p>
<p>Einige CIs, wie TravisCI, unterst√ºtzen ignore-step-failure und melden den gesamten Job als erfolgreich, aber CircleCI und
Github Actions unterst√ºtzen dies zum jetzigen Zeitpunkt nicht.</p>
<p>Sie k√∂nnen also die folgende Abhilfe verwenden:</p>
<ol>
<li>Setzen Sie <code>set +euo pipefail</code> am Anfang des Ausf√ºhrungsbefehls, um die meisten potenziellen Fehler im Bash-Skript zu unterdr√ºcken.</li>
<li>Der letzte Befehl muss ein Erfolg sein: <code>echo "done"</code> oder einfach <code>true</code> reicht aus.</li>
</ol>
<p>Hier ist ein Beispiel:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">run</span><span class="p">:</span>
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">run CI experiment</span>
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="w">        </span><span class="no">set +euo pipefail</span>
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a><span class="w">        </span><span class="no">echo &quot;setting run-all-despite-any-errors-mode&quot;</span>
</span><span id="__span-86-6"><a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a><span class="w">        </span><span class="no">this_command_will_fail</span>
</span><span id="__span-86-7"><a id="__codelineno-86-7" name="__codelineno-86-7" href="#__codelineno-86-7"></a><span class="w">        </span><span class="no">echo &quot;but bash continues to run&quot;</span>
</span><span id="__span-86-8"><a id="__codelineno-86-8" name="__codelineno-86-8" href="#__codelineno-86-8"></a><span class="w">        </span><span class="no"># emulate another failure</span>
</span><span id="__span-86-9"><a id="__codelineno-86-9" name="__codelineno-86-9" href="#__codelineno-86-9"></a><span class="w">        </span><span class="no">false</span>
</span><span id="__span-86-10"><a id="__codelineno-86-10" name="__codelineno-86-10" href="#__codelineno-86-10"></a><span class="w">        </span><span class="no"># but the last command must be a success</span>
</span><span id="__span-86-11"><a id="__codelineno-86-11" name="__codelineno-86-11" href="#__codelineno-86-11"></a><span class="w">        </span><span class="no">echo &quot;during experiment do not remove: reporting success to CI, even if there were failures&quot;</span>
</span></code></pre></div>
<p>F√ºr einfache Befehle k√∂nnen Sie auch Folgendes tun:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a>cmd_that_may_fail<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">true</span>
</span></code></pre></div>
<p>Wenn Sie mit den Ergebnissen zufrieden sind, integrieren Sie den experimentellen Schritt oder Job nat√ºrlich in den Rest der normalen Jobs,
Entfernen Sie dabei <code>set +euo pipefail</code> oder andere Dinge, die Sie eventuell hinzugef√ºgt haben, um sicherzustellen, dass der experimentelle Auftrag nicht
den normalen CI-Betrieb nicht beeintr√§chtigt.</p>
<p>Dieser ganze Prozess w√§re viel einfacher gewesen, wenn wir nur etwas wie <code>allow-failure</code> f√ºr den
experimentellen Schritt festlegen k√∂nnten und ihn scheitern lassen w√ºrden, ohne den Gesamtstatus der PRs zu beeintr√§chtigen. Aber wie bereits erw√§hnt, haben CircleCI und
Github Actions dies im Moment nicht unterst√ºtzen.</p>
<p>Sie k√∂nnen in diesen CI-spezifischen Threads f√ºr diese Funktion stimmen und sehen, wo sie steht:</p>
<ul>
<li><a href="https://github.com/actions/toolkit/issues/399">Github Actions:</a></li>
<li><a href="https://ideas.circleci.com/ideas/CCI-I-344">CircleCI:</a></li>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../../../..", "features": ["navigation.tabs", "navigation.indexes", "navigation.instant", "navigation.sections", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "content.tabs.link", "content.code.copy"], "search": "../../../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>